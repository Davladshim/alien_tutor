{% extends "base.html" %}

{% block title %}–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç —É—á–µ–Ω–∏–∫–∞ - Alien Tutor{% endblock %}

{% block styles %}
<style>
.logout-button-nav {
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    gap: 8px !important;
    padding: 1rem 2rem !important;
    background: rgba(239, 68, 68, 0.1) !important;
    backdrop-filter: blur(10px) !important;
    color: #ef4444 !important;
    border: 1px solid rgba(239, 68, 68, 0.3) !important;
    border-radius: 15px !important;
    text-decoration: none !important;
    font-weight: 500 !important;
    font-size: 1.1rem !important;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1) !important;
    margin-left: 0rem !important;
    position: relative !important;
    overflow: hidden !important;
}

.logout-button-nav:hover {
    background: rgba(239, 68, 68, 0.2) !important;
    transform: translateY(-2px) !important;
}
</style>
{% endblock %}
{% block content %}
    <div class="dashboard-container">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
        <div class="dashboard-header">
            <h1>–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç —É—á–µ–Ω–∏–∫–∞</h1>
            <p class="welcome-text">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{ student.name }}! –ö–ª–∞—Å—Å: {{ student.class }}</p>
        </div>

        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –≤–∫–ª–∞–¥–∫–∞–º -->
        <div class="tabs-navigation">
            <div class="tabs-group">
                <button class="tab-button active" data-tab="schedule">
                    <span class="tab-text">–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</span>
                </button>
                <button class="tab-button" data-tab="progress">
                    <span class="tab-text">–£—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å</span>
                </button>
                <button class="tab-button" data-tab="game">
                    <span class="tab-text">–ò–≥—Ä–∞</span>
                </button>
            </div>
            <a href="/logout" class="logout-button-nav" title="–í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞">
                <span>–í—ã–π—Ç–∏</span>
            </a>
        </div>

        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –≤–∫–ª–∞–¥–æ–∫ -->
        <div class="tabs-content">

            <!-- –í–∫–ª–∞–¥–∫–∞: –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ -->
            <div class="tab-content active" id="schedule-tab">
                <!-- –§—É—Ç—É—Ä–∏—Å—Ç–∏—á–Ω–∞—è –ø–∞–Ω–µ–ª—å –±—ã—Å—Ç—Ä—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π -->
                <div class="futuristic-panel">
                    <div class="panel-icon-left">
                        <div class="icon-circle">
                            <svg class="action-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                <circle cx="9" cy="7" r="4"></circle>
                                <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                            </svg>
                        </div>
                        <div class="icon-tooltip tooltip-right">–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —É—Ä–æ–∫—É</div>
                    </div>
                    
                    <div class="connecting-line-left"></div>
                    
                    <div class="central-panel">
                        <span>–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</span>
                    </div>
                    
                    <div class="connecting-line-right"></div>
                    
                    <div class="panel-icon-right">
                        <div class="icon-circle">
                            <svg class="action-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <rect x="3" y="4" width="18" height="12" rx="1" ry="1"></rect>
                                <line x1="7" y1="8" x2="17" y2="8"></line>
                                <line x1="7" y1="12" x2="13" y2="12"></line>
                                <path d="M8 21l-2-5h12l-2 5"></path>
                            </svg>
                        </div>
                        <div class="icon-tooltip tooltip-left">–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –¥–æ—Å–∫–∞</div>
                    </div>
                </div>
                
                <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —É—á–µ–Ω–∏–∫–∞ -->
                <div class="student-stats">
                    <!-- –ü–µ—Ä–≤–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ -->
                    <div class="stats-card">
                        <div class="stats-value">{{ student.planned_lessons }}</div>
                        <div class="stats-label">–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ –≤ –º–µ—Å—è—Ü–µ</div>
                    </div>
                    <div class="stats-card">
                        <div class="stats-value">{{ student.cancelled_lessons }}</div>
                        <div class="stats-label">–û—Ç–º–µ–Ω–µ–Ω–æ —É—Ä–æ–∫–æ–≤</div>
                    </div>
                    <div class="stats-card">
                        <div class="stats-value">{{ student.lessons_in_stock }}</div>
                        <div class="stats-label">–ó–∞–ø–∞—Å —É—Ä–æ–∫–æ–≤</div>
                    </div>
                    <div class="stats-card">
                        <div class="stats-value">{{ student.completed_lessons }}</div>
                        <div class="stats-label">–ü—Ä–æ–≤–µ–¥–µ–Ω–æ —É—Ä–æ–∫–æ–≤</div>
                    </div>
                </div>

                <!-- –ö–∞–ª–µ–Ω–¥–∞—Ä—å —Å –Ω–∞–≤–∏–≥–∞—Ü–∏–µ–π -->
                <div class="schedule-container">
                    <h2>–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∑–∞–Ω—è—Ç–∏–π</h2>
                    
                    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è –∏ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å -->
                    <div class="schedule-controls">
                        <button class="nav-btn" id="prevWeekBtn">‚Üê –ù–∞–∑–∞–¥</button>
                        
                        <div class="schedule-info">
                            <span class="current-period" id="currentPeriod">{{ student.schedule.week_info.title }}</span>
                            <div class="view-toggle">
                                <button class="toggle-btn active">–ù–µ–¥–µ–ª—è</button>
                                <button class="toggle-btn">–ú–µ—Å—è—Ü</button>
                            </div>
                        </div>
                        
                        <button class="nav-btn" id="nextWeekBtn">–í–ø–µ—Ä–µ–¥ ‚Üí</button>
                    </div>

                    <!-- –ö–∞–ª–µ–Ω–¥–∞—Ä–Ω–∞—è —Å–µ—Ç–∫–∞ -->
                    <div class="schedule-grid">
                        {% for day in student.schedule.week_data %}
                        <div class="day-column {% if day.is_today %}today{% endif %}">
                            <div class="day-header">
                                <div class="day-name">{{ day.day_name }}</div>
                                <div class="day-date">{{ day.day_number }}</div>
                                {% if day.is_today %}
                                    <div class="today-badge">–°–µ–≥–æ–¥–Ω—è</div>
                                {% endif %}
                            </div>
                            <div class="lessons-list">
                                {% if day.lessons %}
                                    {% for lesson in day.lessons %}
                                    <div class="lesson-item-placeholder">
                                        <div class="lesson-time">{{ lesson.time }}</div>
                                        <div class="lesson-subject">{{ lesson.subject }}</div>
                                        {% if lesson.status == 'cancelled' %}
                                            <div class="lesson-status">–û—Ç–º–µ–Ω–µ–Ω</div>
                                        {% endif %}
                                    </div>
                                    {% endfor %}
                                {% else %}
                                    <div class="lesson-placeholder">–ù–µ—Ç –∑–∞–Ω—è—Ç–∏–π</div>
                                {% endif %}
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                <!-- –ú–ï–°–Ø–ß–ù–´–ô –ö–ê–õ–ï–ù–î–ê–†–¨ (—Å–∫—Ä—ã—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
                <div class="month-calendar" id="monthCalendar">

                    <!-- –°–µ—Ç–∫–∞ –∫–∞–ª–µ–Ω–¥–∞—Ä—è 7x6 -->
                    <div class="month-grid" id="monthGrid">
                        <!-- –ó–∞–≥–æ–ª–æ–≤–∫–∏ –¥–Ω–µ–π –Ω–µ–¥–µ–ª–∏ -->
                        <div class="month-day-header">–ü–Ω</div>
                        <div class="month-day-header">–í—Ç</div>
                        <div class="month-day-header">–°—Ä</div>
                        <div class="month-day-header">–ß—Ç</div>
                        <div class="month-day-header">–ü—Ç</div>
                        <div class="month-day-header">–°–±</div>
                        <div class="month-day-header">–í—Å</div>

                        <!-- –Ø—á–µ–π–∫–∏ –¥–Ω–µ–π –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã JavaScript -->
                    </div>
                </div>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞: –£—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å -->
            <div class="tab-content" id="progress-tab">
                <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç–∏ -->
                <div class="class-selector">
                    <h2>–£—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å</h2>
                </div>

                <!-- –î–∏–∞–≥—Ä–∞–º–º—ã -->
                <div class="charts-container">
                    <!-- –°—Ç–æ–ª–±—á–∞—Ç–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ (—Ç–æ–ª—å–∫–æ 9-11 –∫–ª–∞—Å—Å—ã) -->
                    <div class="chart-section bar-chart-section">
                        <h3 id="barChartTitle">–ë–∞–ª–ª—ã –∑–∞ –ø—Ä–æ–±–Ω–∏–∫–∏ –û–ì–≠/–ï–ì–≠</h3>
                        <div class="chart-wrapper">
                            <div class="bar-chart" id="barChart">
                                <!-- –ë—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ JavaScript -->
                            </div>
                        </div>
                    </div>

                    <!-- –ö—Ä—É–≥–æ–≤–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ (–≤—Å–µ –∫–ª–∞—Å—Å—ã) -->
                    <div class="chart-section pie-chart-section">
                        <h3>–ü–æ–Ω–∏–º–∞–Ω–∏–µ —Ç–µ–º</h3>
                        <div class="chart-wrapper">
                            <div class="pie-chart" id="pieChart">
                                <svg viewBox="0 0 200 200" width="200" height="200">
                                    <!-- –ö—Ä—É–≥ –±—É–¥–µ—Ç –æ—Ç—Ä–∏—Å–æ–≤–∞–Ω JavaScript -->
                                </svg>
                                <div class="pie-legend">
                                    <div class="legend-item">
                                        <span class="legend-color" style="background: #10b981;"></span>
                                        <span>–¢–µ–º–∞ —Ä–∞–∑–æ–±—Ä–∞–Ω–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é</span>
                                    </div>
                                    <div class="legend-item">
                                        <span class="legend-color" style="background: #f59e0b;"></span>
                                        <span>–ï—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã –ø–æ —Ç–µ–º–µ</span>
                                    </div>
                                    <div class="legend-item">
                                        <span class="legend-color" style="background: #ef4444;"></span>
                                        <span>–¢–µ–º—É –Ω—É–∂–Ω–æ –∑–∞–∫—Ä–µ–ø–∏—Ç—å</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- –¢–∞–±–ª–∏—Ü–∞ —É—Ä–æ–∫–æ–≤ -->
                <div class="lessons-table-section">
                    <h3>–ò—Å—Ç–æ—Ä–∏—è –ø—Ä–æ–≤–µ–¥–µ–Ω–Ω—ã—Ö —É—Ä–æ–∫–æ–≤</h3>
                    <div class="table-wrapper">
                        <table class="lessons-table">
                            <thead>
                                <tr>
                                    <th>–î–∞—Ç–∞ —É—Ä–æ–∫–∞</th>
                                    <th>–ü—Ä–æ–π–¥–µ–Ω–Ω–∞—è —Ç–µ–º–∞</th>
                                    <th>–ö—Ä–∞—Ç–∫–∏–π –≤—ã–≤–æ–¥</th>
                                    <th class="score-column">–ë–∞–ª–ª—ã –∑–∞ –ø—Ä–æ–±–Ω–∏–∫</th>
                                    <th>–†–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–π –≤—ã–≤–æ–¥</th>
                                </tr>
                            </thead>
                            <tbody id="lessonsTableBody">
                                {% if student.lesson_reports %}
                                    {% for lesson in student.lesson_reports %}
                                    <tr>
                                        <td>{{ lesson.date }}</td>
                                        <td>{{ lesson.topic }}</td>
                                        <td>{{ lesson.understanding }}</td>
                                        <td class="score-cell">{{ lesson.score }}</td>
                                        <td>{{ lesson.feedback }}</td>
                                    </tr>
                                    {% endfor %}
                                {% else %}
                                    <tr>
                                        <td colspan="5" style="text-align: center; color: var(--text-muted); font-style: italic;">
                                            –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ–± —É—Ä–æ–∫–∞—Ö
                                        </td>
                                    </tr>
                                {% endif %}
                            </tbody>
                        </table>
                    </div>
                </div>
                <!-- –ù–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ –¥–æ–º–∞—à–Ω–∏—Ö –∑–∞–¥–∞–Ω–∏–π -->
                <div class="homework-table-section">
                    <h3>–ò—Å—Ç–æ—Ä–∏—è –¥–æ–º–∞—à–Ω–∏—Ö –∑–∞–¥–∞–Ω–∏–π</h3>
                    <div class="table-wrapper">
                        <table class="lessons-table homework-table">
                            <thead id="homeworkTableHeader">
                                <tr>
                                    <th>–î–∞—Ç–∞ –∑–∞–¥–∞–Ω–∏—è</th>
                                    <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                                    <th>–°—Ç–∞—Ç—É—Å</th>
                                    <th>–û—Ü–µ–Ω–∫–∞</th>
                                </tr>
                            </thead>
                            <tbody id="homeworkTableBody">
                                <!-- –¢–∞–±–ª–∏—Ü–∞ –±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ JavaScript –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏ updateHomeworkTable() -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞: –ò–≥—Ä–∞ -->
            <div class="tab-content" id="game-tab">
                <div class="content-section">
                    <h2>üéÆ –ö–æ—Å–º–∏—á–µ—Å–∫–∏–π –ª–∞–±–∏—Ä–∏–Ω—Ç</h2>
                    
                    <div style="text-align: center; margin: 2rem 0;">
                        <a href="/game" target="_blank" class="glass-button game-launch-btn" style="display: inline-block; max-width: 300px; text-decoration: none;">
                            <div class="button-title">üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å –∏–≥—Ä—É</div>
                            <div class="button-subtitle">–ù–∞—á–∞—Ç—å –∫–æ—Å–º–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–µ</div>
                        </a>
                    </div>
                </div>
                
                <div class="content-section">
                    <h2>üèÜ –¢–≤–æ–π —Ä–µ–π—Ç–∏–Ω–≥</h2>
                    <div class="rating-placeholder">
                        <p>–ó–¥–µ—Å—å –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è:</p>
                        <ul>
                            <li>–¢–≤–æ—è –ø–æ–∑–∏—Ü–∏—è –≤ –æ–±—â–µ–º —Ä–µ–π—Ç–∏–Ω–≥–µ</li>
                            <li>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—á–∫–æ–≤ –∑–∞ –∏–≥—Ä—É</li>
                            <li>–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è –∏ –∑–Ω–∞—á–∫–∏</li>
                            <li>–ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ —Ä–µ—à–µ–Ω–Ω—ã–º –∑–∞–¥–∞—á–∞–º</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
<script>
// –î–∞–Ω–Ω—ã–µ –∏–∑ Python (—Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –ë–î)
const studentHomework = {{ student.homework_data | tojson | safe }};
const studentExamResults = {{ student.exam_results | tojson | safe }};
const studentClass = {{ student.class | tojson | safe }};

// –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–ª–∞—Å—Å —É—á–µ–Ω–∏–∫–∞ (—É–±–∏—Ä–∞–µ–º " –∫–ª–∞—Å—Å" –∏–∑ —Å—Ç—Ä–æ–∫–∏)
const currentClass = studentClass.replace(' –∫–ª–∞—Å—Å', '');

// –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –¥–∏–∞–≥—Ä–∞–º–º—ã –¥–ª—è –∫–ª–∞—Å—Å–∞
const hasExamScores = (currentClass === '9' || currentClass === '11');

// –ü–µ—Ä–µ–¥–∞–µ–º –¥–∞–Ω–Ω—ã–µ –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é –æ–±–ª–∞—Å—Ç—å –¥–ª—è dashboard.js
window.studentData = {
    homework: studentHomework,
    examResults: studentExamResults,
    studentClass: studentClass,
    currentClass: currentClass,
    hasExamScores: hasExamScores,
    topicProgress: {{ student.topic_progress | tojson | safe }}
};

// –î–æ–±–∞–≤—å –æ—Ç–ª–∞–¥–æ—á–Ω—ã–π –≤—ã–≤–æ–¥:
console.log('üîç –û–¢–õ–ê–î–ö–ê: –î–∞–Ω–Ω—ã–µ –¥–æ–º–∞—à–µ–∫ –¥–ª—è –¥–∏–∞–≥—Ä–∞–º–º—ã:', studentHomework);

// –ó–∞–ø—É—Å–∫–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', function() {
    console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∏–∞–≥—Ä–∞–º–º...');
    console.log('–î–∞–Ω–Ω—ã–µ –¥–æ–º–∞—à–µ–∫:', studentHomework);
    console.log('–î–∞–Ω–Ω—ã–µ —ç–∫–∑–∞–º–µ–Ω–æ–≤:', studentExamResults);
    console.log('–ö–ª–∞—Å—Å —É—á–µ–Ω–∏–∫–∞:', currentClass);
    
    initChartsForStudentClass();
});
</script>
{% endblock %}