{% extends "base.html" %}

{% block title %}–ì–ª–∞–≤–Ω–∞—è - –ö–∞–ª–µ–Ω–¥–∞—à–∞{% endblock %}

{% block content %}
<div style="text-align: center; margin-bottom: 30px;">
    <h1>–ê–¥–º–∏–Ω—Å–∫–∞—è –ø–∞–Ω–µ–ª—å</h1>
    <p style="color: var(--text-muted); font-size: 16px;">
        –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—á–µ–Ω–∏–∫–∞–º–∏ –∏ –±—ã—Å—Ç—Ä–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ—Ç—á–µ—Ç–æ–≤
    </p>
</div>

<!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ—Ç—á–µ—Ç–∞ –ø–æ —É—Ä–æ–∫—É -->
<div class="card" style="margin-bottom: 30px;">
    <h2 style="margin-bottom: 20px; text-align: center;">–î–æ–±–∞–≤–∏—Ç—å –æ—Ç—á–µ—Ç –ø–æ —É—Ä–æ–∫—É</h2>
    
    <form method="POST" action="/add-lesson-report">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
            
            <!-- –í—ã–±–æ—Ä —É—Ä–æ–∫–∞ -->
            <div>
                <label for="lesson_select">–í—ã–±–µ—Ä–∏—Ç–µ —É—Ä–æ–∫:</label>
                <select id="lesson_select" name="lesson_id" required>
                    <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —É—Ä–æ–∫ --</option>
                    {% if recent_lessons %}
                        {% for lesson in recent_lessons %}
                        <option value="{{ lesson.id }}">
                            {{ lesson.date }} {{ lesson.time }} - {{ lesson.student_name }} ({{ lesson.subject }})
                        </option>
                        {% endfor %}
                    {% endif %}
                    <option value="other">–î—Ä—É–≥–æ–π —É—Ä–æ–∫...</option>
                </select>
            </div>
            
            <!-- –¢–µ–º–∞ —É—Ä–æ–∫–∞ -->
            <div>
                <label for="topic">–¢–µ–º–∞ —É—Ä–æ–∫–∞:</label>
                <input type="text" id="topic" name="topic" required placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ö–≤–∞–¥—Ä–∞—Ç–Ω—ã–µ —É—Ä–∞–≤–Ω–µ–Ω–∏—è">
            </div>
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
            
            <!-- –ü–æ–Ω–∏–º–∞–Ω–∏–µ —Ç–µ–º—ã -->
            <div>
                <label for="understanding">–ü–æ–Ω–∏–º–∞–Ω–∏–µ —Ç–µ–º—ã:</label>
                <select id="understanding" name="understanding_level" required>
                    <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —É—Ä–æ–≤–µ–Ω—å --</option>
                    <option value="–¢–µ–º–∞ —Ä–∞–∑–æ–±—Ä–∞–Ω–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é">–¢–µ–º–∞ —Ä–∞–∑–æ–±—Ä–∞–Ω–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é</option>
                    <option value="–ï—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã –ø–æ —Ç–µ–º–µ">–ï—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã –ø–æ —Ç–µ–º–µ</option>
                    <option value="–¢–µ–º—É –Ω—É–∂–Ω–æ –∑–∞–∫—Ä–µ–ø–∏—Ç—å">–¢–µ–º—É –Ω—É–∂–Ω–æ –∑–∞–∫—Ä–µ–ø–∏—Ç—å</option>
                </select>
            </div>
            
            <!-- –ë–∞–ª–ª—ã –∑–∞ –ø—Ä–æ–±–Ω–∏–∫ -->
            <div>
                <label for="exam_score">–ë–∞–ª–ª—ã –∑–∞ –ø—Ä–æ–±–Ω–∏–∫ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):</label>
                <input type="number" id="exam_score" name="exam_score" min="0" max="100" placeholder="0-100">
            </div>
        </div>
        
        <!-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è -->
        <div style="margin-bottom: 20px;">
            <label for="teacher_comment">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è:</label>
            <textarea id="teacher_comment" name="teacher_comment" rows="3" required 
                      placeholder="–ü–æ–¥—Ä–æ–±–Ω—ã–π –æ—Ç–∑—ã–≤ –æ —Ä–∞–±–æ—Ç–µ —É—á–µ–Ω–∏–∫–∞ –Ω–∞ —É—Ä–æ–∫–µ"></textarea>
        </div>
        
        <!-- –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ -->
        <div style="margin-bottom: 20px;">
            <label for="homework">–î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ:</label>
            <textarea id="homework" name="homework_assigned" rows="2" 
                      placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –¥–æ–º–∞—à–Ω–µ–≥–æ –∑–∞–¥–∞–Ω–∏—è"></textarea>
        </div>
        
        <div style="text-align: center;">
            <button type="submit" class="btn success">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ—Ç—á–µ—Ç</button>
        </div>
    </form>
</div>

<!-- –¢–∞–±–ª–∏—Ü–∞ —É—á–µ–Ω–∏–∫–æ–≤ -->
<div class="card" style="margin-bottom: 30px;">
    <h3 style="text-align: center; margin-bottom: 20px;">üéì –ê–∫–∫–∞—É–Ω—Ç—ã —É—á–µ–Ω–∏–∫–æ–≤</h3>
    
    {% if accounts_data %}
        <div style="overflow-x: auto;">
            <table class="accounts-table">
                <thead>
                    <tr>
                        <th>–£—á–µ–Ω–∏–∫</th>
                        <th>–ö–ª–∞—Å—Å</th>
                        <th>–õ–æ–≥–∏–Ω</th>
                        <th>–ü–∞—Ä–æ–ª—å</th>
                        <th>–õ–ö–£</th>
                    </tr>
                </thead>
                <tbody>
                    {% for account in accounts_data %}
                    <tr>
                        <td class="student-name">{{ account.student_name }}</td>
                        <td>{{ account.student_class }}</td>
                        
                        <!-- –õ–æ–≥–∏–Ω —É—á–µ–Ω–∏–∫–∞ -->
                        <td class="login-cell">
                            {% if account.has_student_account %}
                                <span class="login-text">{{ account.student_login }}</span>
                            {% else %}
                                <span class="no-account">–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞</span>
                            {% endif %}
                        </td>
                        
                        <!-- –ü–∞—Ä–æ–ª—å —É—á–µ–Ω–∏–∫–∞ -->
                        <td class="password-cell">
                            {% if account.has_student_account %}
                                <span class="password-text">{{ account.student_password }}</span>
                            {% else %}
                                <span class="no-account">–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞</span>
                            {% endif %}
                        </td>
                        
                        <!-- –ö–Ω–æ–ø–∫–∞ –õ–ö–£ -->
                        <td class="action-cell">
                            {% if account.has_student_account %}
                                <a href="http://127.0.0.1:8080/admin-student/{{ account.student_id }}?token={{ admin_token }}" 
                                   class="icon-action icon-student" 
                                   title="–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç —É—á–µ–Ω–∏–∫–∞">
                                    <svg viewBox="0 0 24 24" width="28" height="28" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                        <circle cx="12" cy="7" r="4"></circle>
                                    </svg>
                                </a>
                            {% else %}
                                <span class="no-account">‚Äî</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <p style="text-align: center; color: var(--text-muted);">–ù–µ—Ç —É—á–µ–Ω–∏–∫–æ–≤</p>
    {% endif %}
</div>

<!-- –¢–∞–±–ª–∏—Ü–∞ —Ä–æ–¥–∏—Ç–µ–ª–µ–π -->
<div class="card">
    <h3 style="text-align: center; margin-bottom: 20px;">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ –ê–∫–∫–∞—É–Ω—Ç—ã —Ä–æ–¥–∏—Ç–µ–ª–µ–π</h3>
    
    {% if families_data %}
        <div style="overflow-x: auto;">
            <table class="accounts-table parents-table">
                <thead>
                    <tr>
                        <th>–†–æ–¥–∏—Ç–µ–ª—å</th>
                        <th>–î–µ—Ç–∏</th>
                        <th>–õ–æ–≥–∏–Ω</th>
                        <th>–ü–∞—Ä–æ–ª—å</th>
                        <th>–õ–ö–†</th>
                    </tr>
                </thead>
                <tbody>
                    {% for family in families_data %}
                    <tr>
                        <td class="parent-name">{{ family.parent_name }}</td>
                        <td class="children-list">
                            {% for child in family.children %}
                                <span class="child-tag">{{ child }}</span>{% if not loop.last %}, {% endif %}
                            {% endfor %}
                        </td>
                        
                        <!-- –õ–æ–≥–∏–Ω —Ä–æ–¥–∏—Ç–µ–ª—è -->
                        <td class="login-cell">
                            {% if family.has_parent_account %}
                                <span class="login-text">{{ family.parent_login }}</span>
                            {% else %}
                                <span class="no-account">–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞</span>
                            {% endif %}
                        </td>
                        
                        <!-- –ü–∞—Ä–æ–ª—å —Ä–æ–¥–∏—Ç–µ–ª—è -->
                        <td class="password-cell">
                            {% if family.has_parent_account %}
                                <span class="password-text">{{ family.parent_password }}</span>
                            {% else %}
                                <span class="no-account">–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞</span>
                            {% endif %}
                        </td>
                        
                        <!-- –ö–Ω–æ–ø–∫–∞ –õ–ö–† -->
                        <td class="action-cell">
                            {% if family.has_parent_account %}
                                <a href="http://127.0.0.1:8080/admin-parent/{{ family.parent_name }}?token={{ admin_token }}" 
                                   class="icon-action icon-parent" 
                                   title="–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç —Ä–æ–¥–∏—Ç–µ–ª—è">
                                    <svg viewBox="0 0 24 24" width="28" height="28" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
                                        <circle cx="9" cy="7" r="4"></circle>
                                        <path d="M22 21v-2a4 4 0 0 0-3-3.87"></path>
                                        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                                    </svg>
                                </a>
                            {% else %}
                                <span class="no-account">‚Äî</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <p style="text-align: center; color: var(--text-muted);">–ù–µ—Ç —Ä–æ–¥–∏—Ç–µ–ª–µ–π</p>
    {% endif %}
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const lessonSelect = document.getElementById('lesson_select');
    
    lessonSelect.addEventListener('change', function() {
        if (this.value === 'other') {
            // –°–æ–∑–¥–∞–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –¥–ª—è –ø–æ–∏—Å–∫–∞ —É—Ä–æ–∫–∞
            const container = this.parentElement;
            
            // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –ø–æ–ª—è –µ—Å–ª–∏ –µ—Å—Ç—å
            const existingFields = container.querySelector('.other-lesson-fields');
            if (existingFields) {
                existingFields.remove();
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ –ø–æ–ª—è
            const otherFields = document.createElement('div');
            otherFields.className = 'other-lesson-fields';
            otherFields.style.marginTop = '10px';
            otherFields.innerHTML = `
                <label>–î–∞—Ç–∞ —É—Ä–æ–∫–∞:</label>
                <input type="date" name="other_date" required style="margin-bottom: 10px;">
                <label>–í—Ä–µ–º—è —É—Ä–æ–∫–∞:</label>
                <input type="time" name="other_time" required style="margin-bottom: 10px;">
                <button type="button" onclick="findOtherLesson()" class="btn" style="padding: 8px 16px; margin-top: 5px;">
                    –ù–∞–π—Ç–∏ —É—Ä–æ–∫
                </button>
            `;
            
            container.appendChild(otherFields);
        } else {
            // –£–¥–∞–ª—è–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
            const existingFields = container.querySelector('.other-lesson-fields');
            if (existingFields) {
                existingFields.remove();
            }
        }
    });
});

function findOtherLesson() {
    alert('–§—É–Ω–∫—Ü–∏—è –ø–æ–∏—Å–∫–∞ —É—Ä–æ–∫–∞ –ø–æ –¥–∞—Ç–µ/–≤—Ä–µ–º–µ–Ω–∏ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–∑–∂–µ');
}
</script>

{% endblock %}