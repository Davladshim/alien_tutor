{% extends "base.html" %}

{% block title %}–ì–ª–∞–≤–Ω–∞—è - –ö–∞–ª–µ–Ω–¥–∞—à–∞{% endblock %}


{% block content %}

<div style="text-align: center; margin-bottom: 30px;">
    <h1>–ê–¥–º–∏–Ω—Å–∫–∞—è –ø–∞–Ω–µ–ª—å</h1>
    <p style="color: var(--text-muted); font-size: 16px;">
        –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—á–µ–Ω–∏–∫–∞–º–∏ –∏ –±—ã—Å—Ç—Ä–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ—Ç—á–µ—Ç–æ–≤
    </p>
</div>

<!-- –ù–û–í–ê–Ø –°–ò–°–¢–ï–ú–ê –û–¢–ß–ï–¢–û–í –ò –î–û–ú–ê–®–ï–ö -->
<div style="margin-bottom: 30px;">
    <h2 style="margin-bottom: 25px; text-align: center;">–û—Ç—á–µ—Ç—ã –ø–æ —É—Ä–æ–∫–∞–º –∏ –¥–æ–º–∞—à–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è</h2>
    
    <!-- –ë–ª–æ–∫ –≤—ã–±–æ—Ä–∞ –¥–∞—Ç—ã —Å–æ —Å—á–µ—Ç—á–∏–∫–æ–º -->
    <div style="background: var(--bg-card); border-radius: 12px; padding: 20px; margin-bottom: 25px; border: 1px solid var(--border-secondary);">
        <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">

            <!-- –í—ã–±–æ—Ä –¥–∞—Ç—ã -->
            <div style="flex: 1; min-width: 200px;">
                <label for="date_select" style="display: block; margin-bottom: 8px; font-weight: bold;">
                    –í—ã–±—Ä–∞—Ç—å –¥–∞—Ç—É:
                </label>
                <input type="date" id="date_select" style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid var(--border-secondary);">
            </div>

            <!-- –í—ã–±–æ—Ä –º–µ—Å—è—Ü–∞ –¥–ª—è —Å—á–µ—Ç—á–∏–∫–æ–≤ -->
            <div style="min-width: 200px;">
                <label for="month_select" style="display: block; margin-bottom: 8px; font-weight: bold;">
                    –ú–µ—Å—è—Ü –¥–ª—è —Å—á–µ—Ç—á–∏–∫–æ–≤:
                </label>
                <input type="month" id="month_select" style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid var(--border-secondary);">
            </div>
            
            <!-- –°—á–µ—Ç—á–∏–∫ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö —É—Ä–æ–∫–æ–≤ -->
            <div style="text-align: center;">
                <div style="font-size: 14px; color: var(--text-muted); margin-bottom: 5px;">
                    –¢—Ä–µ–±—É—é—Ç –≤–Ω–∏–º–∞–Ω–∏—è:
                </div>
                <div style="display: flex; gap: 15px; align-items: center;">
                    <div style="text-align: center;">
                        <div style="font-size: 24px; font-weight: bold; color: #ef4444;" id="homework_missing_count">
                            3
                        </div>
                        <div style="font-size: 12px; color: var(--text-muted);">
                            –±–µ–∑ –¥–æ–º–∞—à–∫–∏
                        </div>
                    </div>
                    <div style="font-size: 18px; color: var(--text-muted);">/</div>
                    <div style="text-align: center;">
                        <div style="font-size: 24px; font-weight: bold; color: #f59e0b;" id="homework_unchecked_count">
                            2
                        </div>
                        <div style="font-size: 12px; color: var(--text-muted);">
                            –Ω–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã
                        </div>
                    </div>
                    <div style="font-size: 18px; color: var(--text-muted);">/</div>
                    <div style="text-align: center;">
                        <div style="font-size: 24px; font-weight: bold; color: #ef4444;" id="reports_missing_count">
                            1
                        </div>
                        <div style="font-size: 12px; color: var(--text-muted);">
                            –±–µ–∑ –æ—Ç—á–µ—Ç–∞
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
<!-- –ë–ª–æ–∫–∏ —Å —É—Ä–æ–∫–∞–º–∏ - –∑–∞–ø–æ–ª–Ω—è—é—Ç—Å—è –∏–∑ –ë–î -->
<div style="display: grid; grid-template-columns: 1fr; gap: 20px; margin-bottom: 30px;">
    
    <!-- –£—Ä–æ–∫–∏ –≤—á–µ—Ä–∞ - –¥–æ 12 —É—Ä–æ–∫–æ–≤ (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ 1-2 —Å—Ç—Ä–æ–∫–∏) -->
    <table style="width: 100%; border-collapse: collapse;">
        <tr>
            <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ - –∑–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–∞ 2 —Å—Ç—Ä–æ–∫–∏ -->
            <td rowspan="2" style="width: 200px; background: var(--accent-gradient); color: white; padding: 20px; 
                    font-weight: bold; font-size: 18px; text-align: center; vertical-align: middle; 
                    border-right: 2px solid var(--border-secondary);">
                –£—Ä–æ–∫–∏ –≤—á–µ—Ä–∞<br>
                <span id="yesterday_date" style="font-size: 14px; font-weight: normal;">(–∑–∞–≥—Ä—É–∑–∫–∞...)</span>
            </td>
            
            <!-- –ü–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞: 6 –ø—É—Å—Ç—ã—Ö —è—á–µ–µ–∫ - JavaScript –∏—Ö –∑–∞–ø–æ–ª–Ω–∏—Ç -->
            <td style="background: var(--bg-card); padding: 15px; border-right: 1px solid var(--border-secondary); width: 200px;">
                <div style="text-align: center; color: var(--text-muted); font-style: italic;">–ù–µ—Ç —É—Ä–æ–∫–∞</div>
            </td>
            <td style="background: var(--bg-card); padding: 15px; border-right: 1px solid var(--border-secondary); width: 200px;">
                <div style="text-align: center; color: var(--text-muted); font-style: italic;">–ù–µ—Ç —É—Ä–æ–∫–∞</div>
            </td>
            <td style="background: var(--bg-card); padding: 15px; border-right: 1px solid var(--border-secondary); width: 200px;">
                <div style="text-align: center; color: var(--text-muted); font-style: italic;">–ù–µ—Ç —É—Ä–æ–∫–∞</div>
            </td>
            <td style="background: var(--bg-card); padding: 15px; border-right: 1px solid var(--border-secondary); width: 200px;">
                <div style="text-align: center; color: var(--text-muted); font-style: italic;">–ù–µ—Ç —É—Ä–æ–∫–∞</div>
            </td>
            <td style="background: var(--bg-card); padding: 15px; border-right: 1px solid var(--border-secondary); width: 200px;">
                <div style="text-align: center; color: var(--text-muted); font-style: italic;">–ù–µ—Ç —É—Ä–æ–∫–∞</div>
            </td>
            <td style="background: var(--bg-card); padding: 15px; width: 200px;">
                <div style="text-align: center; color: var(--text-muted); font-style: italic;">–ù–µ—Ç —É—Ä–æ–∫–∞</div>
            </td>
        </tr>
        <tr id="yesterday_row_2" style="display: none;">
            <!-- –í—Ç–æ—Ä–∞—è —Å—Ç—Ä–æ–∫–∞: –µ—â–µ 6 –ø—É—Å—Ç—ã—Ö —è—á–µ–µ–∫ (—Å–∫—Ä—ã—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
            <td style="background: var(--bg-card); padding: 15px; border-right: 1px solid var(--border-secondary); width: 200px;">
                <div style="text-align: center; color: var(--text-muted); font-style: italic;">–ù–µ—Ç —É—Ä–æ–∫–∞</div>
            </td>
            <td style="background: var(--bg-card); padding: 15px; border-right: 1px solid var(--border-secondary); width: 200px;">
                <div style="text-align: center; color: var(--text-muted); font-style: italic;">–ù–µ—Ç —É—Ä–æ–∫–∞</div>
            </td>
            <td style="background: var(--bg-card); padding: 15px; border-right: 1px solid var(--border-secondary); width: 200px;">
                <div style="text-align: center; color: var(--text-muted); font-style: italic;">–ù–µ—Ç —É—Ä–æ–∫–∞</div>
            </td>
            <td style="background: var(--bg-card); padding: 15px; border-right: 1px solid var(--border-secondary); width: 200px;">
                <div style="text-align: center; color: var(--text-muted); font-style: italic;">–ù–µ—Ç —É—Ä–æ–∫–∞</div>
            </td>
            <td style="background: var(--bg-card); padding: 15px; border-right: 1px solid var(--border-secondary); width: 200px;">
                <div style="text-align: center; color: var(--text-muted); font-style: italic;">–ù–µ—Ç —É—Ä–æ–∫–∞</div>
            </td>
            <td style="background: var(--bg-card); padding: 15px; width: 200px;">
                <div style="text-align: center; color: var(--text-muted); font-style: italic;">–ù–µ—Ç —É—Ä–æ–∫–∞</div>
            </td>
        </tr>
    </table>
    
    <!-- –£—Ä–æ–∫–∏ —Å–µ–≥–æ–¥–Ω—è - –¥–æ 12 —É—Ä–æ–∫–æ–≤ (2 —Å—Ç—Ä–æ–∫–∏ –ø–æ 6) -->
    <table style="width: 100%; border-collapse: collapse;">
        <tr>
            <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ - –∑–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–∞ 2 —Å—Ç—Ä–æ–∫–∏ -->
            <td rowspan="2" style="width: 200px; background: var(--accent-gradient); color: white; padding: 20px; 
                    font-weight: bold; font-size: 18px; text-align: center; vertical-align: middle; 
                    border-right: 2px solid var(--border-secondary);">
                <span id="today_lessons_title">–£—Ä–æ–∫–∏ —Å–µ–≥–æ–¥–Ω—è</span><br>
                <span id="today_lessons_date" style="font-size: 14px; font-weight: normal;">(–∑–∞–≥—Ä—É–∑–∫–∞...)</span>
            </td>
            
            <!-- –ü–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞: 6 –ø—É—Å—Ç—ã—Ö —è—á–µ–µ–∫ - JavaScript –∏—Ö –∑–∞–ø–æ–ª–Ω–∏—Ç -->
            <td style="background: var(--bg-card); padding: 15px; border-right: 1px solid var(--border-secondary); width: 200px;">
                <div style="text-align: center; color: var(--text-muted); font-style: italic;">–ù–µ—Ç —É—Ä–æ–∫–∞</div>
            </td>
            <td style="background: var(--bg-card); padding: 15px; border-right: 1px solid var(--border-secondary); width: 200px;">
                <div style="text-align: center; color: var(--text-muted); font-style: italic;">–ù–µ—Ç —É—Ä–æ–∫–∞</div>
            </td>
            <td style="background: var(--bg-card); padding: 15px; border-right: 1px solid var(--border-secondary); width: 200px;">
                <div style="text-align: center; color: var(--text-muted); font-style: italic;">–ù–µ—Ç —É—Ä–æ–∫–∞</div>
            </td>
            <td style="background: var(--bg-card); padding: 15px; border-right: 1px solid var(--border-secondary); width: 200px;">
                <div style="text-align: center; color: var(--text-muted); font-style: italic;">–ù–µ—Ç —É—Ä–æ–∫–∞</div>
            </td>
            <td style="background: var(--bg-card); padding: 15px; border-right: 1px solid var(--border-secondary); width: 200px;">
                <div style="text-align: center; color: var(--text-muted); font-style: italic;">–ù–µ—Ç —É—Ä–æ–∫–∞</div>
            </td>
            <td style="background: var(--bg-card); padding: 15px; width: 200px;">
                <div style="text-align: center; color: var(--text-muted); font-style: italic;">–ù–µ—Ç —É—Ä–æ–∫–∞</div>
            </td>
        </tr>
        <tr id="today_row_2">
            <!-- –í—Ç–æ—Ä–∞—è —Å—Ç—Ä–æ–∫–∞: –µ—â–µ 6 –ø—É—Å—Ç—ã—Ö —è—á–µ–µ–∫ - JavaScript –∏—Ö –∑–∞–ø–æ–ª–Ω–∏—Ç -->
            <td style="background: var(--bg-card); padding: 15px; border-right: 1px solid var(--border-secondary); width: 200px;">
                <div style="text-align: center; color: var(--text-muted); font-style: italic;">–ù–µ—Ç —É—Ä–æ–∫–∞</div>
            </td>
            <td style="background: var(--bg-card); padding: 15px; border-right: 1px solid var(--border-secondary); width: 200px;">
                <div style="text-align: center; color: var(--text-muted); font-style: italic;">–ù–µ—Ç —É—Ä–æ–∫–∞</div>
            </td>
            <td style="background: var(--bg-card); padding: 15px; border-right: 1px solid var(--border-secondary); width: 200px;">
                <div style="text-align: center; color: var(--text-muted); font-style: italic;">–ù–µ—Ç —É—Ä–æ–∫–∞</div>
            </td>
            <td style="background: var(--bg-card); padding: 15px; border-right: 1px solid var(--border-secondary); width: 200px;">
                <div style="text-align: center; color: var(--text-muted); font-style: italic;">–ù–µ—Ç —É—Ä–æ–∫–∞</div>
            </td>
            <td style="background: var(--bg-card); padding: 15px; border-right: 1px solid var(--border-secondary); width: 200px;">
                <div style="text-align: center; color: var(--text-muted); font-style: italic;">–ù–µ—Ç —É—Ä–æ–∫–∞</div>
            </td>
            <td style="background: var(--bg-card); padding: 15px; width: 200px;">
                <div style="text-align: center; color: var(--text-muted); font-style: italic;">–ù–µ—Ç —É—Ä–æ–∫–∞</div>
            </td>
        </tr>
    </table>
</div>
<!-- –§–æ—Ä–º—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º —É—Ä–æ–∫–æ–º -->
<div id="lesson_forms" style="border: 2px solid var(--accent-color, #00d4ff); border-radius: 15px; padding: 25px; display: none;">
    <div id="selected_lesson_info" style="background: var(--accent-gradient); color: white; padding: 15px; border-radius: 10px; margin-bottom: 25px; text-align: center; font-weight: bold; font-size: 18px;">
        –í—ã–±–µ—Ä–∏—Ç–µ —É—Ä–æ–∫ –¥–ª—è —Ä–∞–±–æ—Ç—ã
    </div>
    
    <!-- –û–ë–™–ï–î–ò–ù–ï–ù–ù–ê–Ø –§–û–†–ú–ê -->
    <div class="combined-form">
        
        <!-- –°–ï–ö–¶–ò–Ø –û–¢–ß–ï–¢–ê -->
        <div class="report-section" style="margin-bottom: 40px;">
            <h3 style="color: var(--text-accent); margin-bottom: 20px;">üìù –û—Ç—á–µ—Ç –ø–æ —É—Ä–æ–∫—É</h3>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 20px;">
                <div>
                    <label>–¢–µ–º–∞ —É—Ä–æ–∫–∞:</label>
                    <input type="text" id="report_topic" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ö–≤–∞–¥—Ä–∞—Ç–Ω—ã–µ —É—Ä–∞–≤–Ω–µ–Ω–∏—è" style="width: 100%;">
                </div>
                
                <div>
                    <label>–ü–æ–Ω–∏–º–∞–Ω–∏–µ —Ç–µ–º—ã:</label>
                    <select id="report_understanding" style="width: 100%;">
                        <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —É—Ä–æ–≤–µ–Ω—å --</option>
                        <option value="–¢–µ–º–∞ —Ä–∞–∑–æ–±—Ä–∞–Ω–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é">–¢–µ–º–∞ —Ä–∞–∑–æ–±—Ä–∞–Ω–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é</option>
                        <option value="–ï—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã –ø–æ —Ç–µ–º–µ">–ï—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã –ø–æ —Ç–µ–º–µ</option>
                        <option value="–¢–µ–º—É –Ω—É–∂–Ω–æ –∑–∞–∫—Ä–µ–ø–∏—Ç—å">–¢–µ–º—É –Ω—É–∂–Ω–æ –∑–∞–∫—Ä–µ–ø–∏—Ç—å</option>
                    </select>
                </div>
            </div>
            
            <div style="margin-bottom: 20px;">
                <label>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è:</label>
                <textarea id="report_comment" rows="3" placeholder="–ü–æ–¥—Ä–æ–±–Ω—ã–π –æ—Ç–∑—ã–≤ –æ —Ä–∞–±–æ—Ç–µ —É—á–µ–Ω–∏–∫–∞ –Ω–∞ —É—Ä–æ–∫–µ" style="width: 100%;"></textarea>
            </div>

            <!-- –ö–Ω–æ–ø–∫–∞ –ø—Ä–æ–±–Ω–∏–∫ –∏ –±–∞–ª–ª—ã –≤ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                <div>
                    <label style="visibility: hidden;">–ü—Ä–æ–±–Ω–∏–∫</label>
                    <button type="button" class="btn warning" onclick="openProbnikModal('report')" style="width: 100%;">–ü—Ä–æ–±–Ω–∏–∫</button>
                </div>
                
                <div>
                    <label>–ü–µ—Ä–≤–∏—á–Ω—ã–µ –±–∞–ª–ª—ã:</label>
                    <input type="number" id="report_primary_score" min="0" max="50" placeholder="0-50" style="width: 100%;">
                </div>
                
                <div>
                    <label>–í—Ç–æ—Ä–∏—á–Ω—ã–µ –±–∞–ª–ª—ã:</label>
                    <input type="number" id="report_secondary_score" min="0" max="100" placeholder="0-100" style="width: 100%;">
                </div>
            </div>
            
            <div style="text-align: center;">
                <button type="button" class="btn success" style="margin-right: 10px;" onclick="saveReport()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ—Ç—á–µ—Ç</button>
                <button type="button" class="btn danger" onclick="deleteReport()">–£–¥–∞–ª–∏—Ç—å –æ—Ç—á–µ—Ç</button>
            </div>
        </div>
        
        <!-- –†–ê–ó–î–ï–õ–ò–¢–ï–õ–¨ -->
        <div style="border-top: 2px solid var(--border-secondary); margin: 30px 0;"></div>
        
        <!-- –°–ï–ö–¶–ò–Ø –î–û–ú–ê–®–ö–ò -->
        <div class="homework-section">
            <h3 style="color: var(--text-accent); margin-bottom: 20px;">üìö –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ</h3>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 20px;">
                <div>
                    <label>–¢–∏–ø –¥–æ–º–∞—à–Ω–µ–≥–æ –∑–∞–¥–∞–Ω–∏—è:</label>
                    <select id="homework_type" onchange="toggleHomeworkFields()" style="width: 100%;">
                        <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø --</option>
                        <option value="tasks">–î–∞—Ç—å –∑–∞–¥–∞—á–∏</option>
                        <option value="none">–ù–µ –∑–∞–¥–∞–≤–∞—Ç—å –¥–æ–º–∞—à–∫—É</option>
                    </select>
                </div>
                
                <div id="homework_evaluation_fields" style="display: none;">
                    <label>–†–µ—à–µ–Ω–∏–µ:</label>
                    <select id="homework_solution_score" style="width: 100%;">
                        <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ --</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                        <option value="9">9</option>
                        <option value="10">10</option>
                    </select>
                </div>
                
                <div id="homework_formatting_fields" style="display: none;">
                    <label>–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ:</label>
                    <select id="homework_formatting_score" style="width: 100%;">
                        <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ --</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                        <option value="9">9</option>
                        <option value="10">10</option>
                    </select>
                </div>
            </div>
            
            <div id="homework_content_fields" style="display: none;">
                <div style="margin-bottom: 20px;">
                    <label>–û–ø–∏—Å–∞–Ω–∏–µ –¥–æ–º–∞—à–Ω–µ–≥–æ –∑–∞–¥–∞–Ω–∏—è:</label>
                    <textarea id="homework_description" rows="3" placeholder="–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏–π" style="width: 100%;"></textarea>
                </div>

                <!-- –ö–Ω–æ–ø–∫–∞ –ø—Ä–æ–±–Ω–∏–∫ –∏ –±–∞–ª–ª—ã –ø–æ–¥ –æ–ø–∏—Å–∞–Ω–∏–µ–º -->
                <div id="homework_probnik_fields" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px; display: none;">
                    <div>
                        <label style="visibility: hidden;">–ü—Ä–æ–±–Ω–∏–∫</label>
                        <button type="button" class="btn warning" onclick="openProbnikModal('homework')" style="width: 100%;">–ü—Ä–æ–±–Ω–∏–∫</button>
                    </div>
                    
                    <div>
                        <label>–ü–µ—Ä–≤–∏—á–Ω—ã–µ –±–∞–ª–ª—ã:</label>
                        <input type="number" id="homework_primary_score" min="0" max="50" placeholder="0-50" style="width: 100%;">
                    </div>
                    
                    <div>
                        <label>–í—Ç–æ—Ä–∏—á–Ω—ã–µ –±–∞–ª–ª—ã:</label>
                        <input type="number" id="homework_secondary_score" min="0" max="100" placeholder="0-100" style="width: 100%;">
                    </div>
                </div>
            </div>
            
            <div style="text-align: center;">
                <button type="button" class="btn success" style="margin-right: 10px;" onclick="saveHomework()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–æ–º–∞—à–∫—É</button>
                <button type="button" class="btn warning" style="margin-right: 10px;" onclick="markHomeworkChecked()">–û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—É—é</button>
                <button type="button" class="btn danger" onclick="deleteHomework()">–£–¥–∞–ª–∏—Ç—å –î/–ó</button>
            </div>
        </div>
        
    </div> <!-- –∫–æ–Ω–µ—Ü combined-form -->
</div>

<!-- –¢–∞–±–ª–∏—Ü–∞ —É—á–µ–Ω–∏–∫–æ–≤ -->
<h3 style="text-align: center; margin-bottom: 20px;">–ê–∫–∫–∞—É–Ω—Ç—ã —É—á–µ–Ω–∏–∫–æ–≤</h3>

{% if accounts_data %}
    <div style="overflow-x: auto;">
        <table class="accounts-table">
            <thead>
                <tr>
                    <th>–£—á–µ–Ω–∏–∫</th>
                    <th>–ö–ª–∞—Å—Å</th>
                    <th>–õ–æ–≥–∏–Ω</th>
                    <th>–ü–∞—Ä–æ–ª—å</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody>
                {% for account in accounts_data %}
                <tr>
                    <td class="student-name">{{ account.student_name }}</td>
                    <td>{{ account.student_class }}</td>
                    
                    <!-- –õ–æ–≥–∏–Ω —É—á–µ–Ω–∏–∫–∞ -->
                    <td class="login-cell">
                        {% if account.has_student_account %}
                            <span class="login-text">{{ account.student_login }}</span>
                        {% else %}
                            <span class="no-account">–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞</span>
                        {% endif %}
                    </td>
                    
                    <!-- –ü–∞—Ä–æ–ª—å —É—á–µ–Ω–∏–∫–∞ -->
                    <td class="password-cell">
                        {% if account.has_student_account %}
                            <span class="password-text">{{ account.student_password }}</span>
                        {% else %}
                            <span class="no-account">–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞</span>
                        {% endif %}
                    </td>
                    
                    <!-- –ö–Ω–æ–ø–∫–∞ –õ–ö–£ -->
                    <td class="action-cell">
                        {% if account.has_student_account %}
                            <div style="display: flex; gap: 25px; align-items: center;">
                                <!-- –ö–Ω–æ–ø–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è -->
                                <a onclick="copyLoginPassword('{{ account.student_login }}', '{{ account.student_password }}'); return false;" 
                                href="#"
                                class="icon-action" 
                                title="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å">
                                    <svg viewBox="0 0 24 24" width="28" height="28" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                                    </svg>
                                </button>
                                
                                <!-- –ö–Ω–æ–ø–∫–∞ –õ–ö–£ -->
                                <a href="http://127.0.0.1:8080/admin-student/{{ account.student_id }}?token={{ admin_token }}" 
                                class="icon-action"
                                title="–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç —É—á–µ–Ω–∏–∫–∞"
                                target="_blank">
                                    <svg viewBox="0 0 24 24" width="28" height="28" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                        <circle cx="12" cy="7" r="4"></circle>
                                    </svg>
                                </a>
                            </div>
                        {% else %}
                            <span class="no-account">‚Äî</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
{% else %}
    <p style="text-align: center; color: var(--text-muted);">–ù–µ—Ç —É—á–µ–Ω–∏–∫–æ–≤</p>
{% endif %}

<!-- –¢–∞–±–ª–∏—Ü–∞ —Ä–æ–¥–∏—Ç–µ–ª–µ–π -->
<h3 style="text-align: center; margin-bottom: 20px;">–ê–∫–∫–∞—É–Ω—Ç—ã —Ä–æ–¥–∏—Ç–µ–ª–µ–π</h3>

{% if families_data %}
    <div style="overflow-x: auto;">
        <table class="accounts-table parents-table">
            <thead>
                <tr>
                    <th>–†–æ–¥–∏—Ç–µ–ª—å</th>
                    <th>–î–µ—Ç–∏</th>
                    <th>–õ–æ–≥–∏–Ω</th>
                    <th>–ü–∞—Ä–æ–ª—å</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody>
                {% for family in families_data %}
                <tr>
                    <td class="parent-name">{{ family.parent_name }}</td>
                    <td class="children-list">
                        {% for child in family.children %}
                            <span class="child-tag">{{ child }}</span>{% if not loop.last %}, {% endif %}
                        {% endfor %}
                    </td>
                    
                    <!-- –õ–æ–≥–∏–Ω —Ä–æ–¥–∏—Ç–µ–ª—è -->
                    <td class="login-cell">
                        {% if family.has_parent_account %}
                            <span class="login-text">{{ family.parent_login }}</span>
                        {% else %}
                            <span class="no-account">–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞</span>
                        {% endif %}
                    </td>
                    
                    <!-- –ü–∞—Ä–æ–ª—å —Ä–æ–¥–∏—Ç–µ–ª—è -->
                    <td class="password-cell">
                        {% if family.has_parent_account %}
                            <span class="password-text">{{ family.parent_password }}</span>
                        {% else %}
                            <span class="no-account">–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞</span>
                        {% endif %}
                    </td>
                    
                    <!-- –ö–Ω–æ–ø–∫–∞ –õ–ö–† -->
                    <td class="action-cell">
                        {% if family.has_parent_account %}
                            <div style="display: flex; gap: 25px; align-items: center;">
                                <!-- –ö–Ω–æ–ø–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è -->
                                <a onclick="copyLoginPassword('{{ family.parent_login }}', '{{ family.parent_password }}'); return false;" 
                                href="#"
                                class="icon-action" 
                                title="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å">
                                    <svg viewBox="0 0 24 24" width="28" height="28" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                                    </svg>
                                </button>
                                
                                <!-- –ö–Ω–æ–ø–∫–∞ –õ–ö–† -->
                                <a href="http://127.0.0.1:8080/admin-parent/{{ family.parent_name }}?token={{ admin_token }}" 
                                class="icon-action" 
                                title="–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç —Ä–æ–¥–∏—Ç–µ–ª—è"
                                target="_blank">
                                    <svg viewBox="0 0 24 24" width="28" height="28" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
                                        <circle cx="9" cy="7" r="4"></circle>
                                        <path d="M22 21v-2a4 4 0 0 0-3-3.87"></path>
                                        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                                    </svg>
                                </a>
                            </div>
                        {% else %}
                            <span class="no-account">‚Äî</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
{% else %}
    <p style="text-align: center; color: var(--text-muted);">–ù–µ—Ç —Ä–æ–¥–∏—Ç–µ–ª–µ–π</p>
{% endif %}

<!-- –ê–¥–º–∏–Ω-—Ñ—É–Ω–∫—Ü–∏–∏ -->
<div class="card" style="margin-top: 30px; border: 2px solid #ef4444;">
    <h3 style="text-align: center; margin-bottom: 20px; color: #ffffff; background: var(--danger-gradient); padding: 15px; border-radius: 12px; box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);">‚ö†Ô∏è –û–ø–∞—Å–Ω—ã–µ –∞–¥–º–∏–Ω-—Ñ—É–Ω–∫—Ü–∏–∏</h3>
    
    <div style="background: rgba(239, 68, 68, 0.1); padding: 20px; border-radius: 12px; margin-bottom: 20px;">
        <p style="color: #ffffff; text-align: center; font-weight: bold; margin-bottom: 10px;">
            üö® –í–ù–ò–ú–ê–ù–ò–ï! –≠—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏ —É–¥–∞–ª—è—é—Ç –¥–∞–Ω–Ω—ã–µ –±–µ–∑ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è!
        </p>
        <p style="color: var(--text-muted); text-align: center; font-size: 14px;">
            –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ç–æ—á–Ω–æ –∑–Ω–∞–µ—Ç–µ, —á—Ç–æ –¥–µ–ª–∞–µ—Ç–µ
        </p>
    </div>
    
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
        
        <!-- –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ -->
        <div style="text-align: center;">
            <button onclick="confirmClearSchedule()" 
                    style="background: var(--danger-gradient); color: white; padding: 15px 20px; 
                        border: none; border-radius: 12px; cursor: pointer; width: 100%; 
                        font-weight: bold; box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);">
                üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
            </button>
            <p style="font-size: 12px; color: var(--text-muted); margin-top: 8px;">
                –£–¥–∞–ª–∏—Ç –≤—Å–µ —É—Ä–æ–∫–∏, –ø–ª–∞—Ç–µ–∂–∏ –∏ –æ—Ç—á–µ—Ç—ã
            </p>
        </div>
        
        <!-- –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç—ã -->
        <div style="text-align: center;">
            <button onclick="confirmRecreateAccounts()" 
                    style="background: var(--danger-gradient); color: white; padding: 15px 20px; 
                        border: none; border-radius: 12px; cursor: pointer; width: 100%; 
                        font-weight: bold; box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);">
                üîÑ –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –≤—Å–µ –∞–∫–∫–∞—É–Ω—Ç—ã
            </button>
            <p style="font-size: 12px; color: var(--text-muted); margin-top: 8px;">
                –£–¥–∞–ª–∏—Ç –≤—Å–µ –ª–æ–≥–∏–Ω—ã/–ø–∞—Ä–æ–ª–∏ –∏ —Å–æ–∑–¥–∞—Å—Ç –Ω–æ–≤—ã–µ
            </p>
        </div>
        
        <!-- –£–¥–∞–ª–∏—Ç—å –æ—Ç—á–µ—Ç—ã -->
        <div style="text-align: center;">
            <button onclick="confirmClearReports()" 
                    style="background: var(--danger-gradient); color: white; padding: 15px 20px; 
                        border: none; border-radius: 12px; cursor: pointer; width: 100%; 
                        font-weight: bold; box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);">
                üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –æ—Ç—á–µ—Ç—ã
            </button>
            <p style="font-size: 12px; color: var(--text-muted); margin-top: 8px;">
                –£–¥–∞–ª–∏—Ç –≤—Å–µ –æ—Ç—á–µ—Ç—ã –ø–æ —É—Ä–æ–∫–∞–º
            </p>
        </div>
        
        <!-- –£–¥–∞–ª–∏—Ç—å –¥–æ–º–∞—à–∫–∏ -->
        <div style="text-align: center;">
            <button onclick="confirmClearHomework()" 
                    style="background: var(--danger-gradient); color: white; padding: 15px 20px; 
                        border: none; border-radius: 12px; cursor: pointer; width: 100%; 
                        font-weight: bold; box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);">
                üìö –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –¥–æ–º–∞—à–∫–∏
            </button>
            <p style="font-size: 12px; color: var(--text-muted); margin-top: 8px;">
                –£–¥–∞–ª–∏—Ç –≤—Å–µ –¥–æ–º–∞—à–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è
            </p>
        </div>
        
    </div>
</div>

<script>
function confirmRecreateAccounts() {
    if (confirm('‚ö†Ô∏è –í–´ –£–í–ï–†–ï–ù–´?\n\n–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ:\n- –£–¥–∞–ª–∏—Ç –í–°–ï —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ª–æ–≥–∏–Ω—ã –∏ –ø–∞—Ä–æ–ª–∏\n- –°–æ–∑–¥–∞—Å—Ç –Ω–æ–≤—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã –¥–ª—è –≤—Å–µ—Ö —É—á–µ–Ω–∏–∫–æ–≤\n- –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥–µ—Ç –ù–ï–í–û–ó–ú–û–ñ–ù–û\n\n–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?')) {
        if (confirm('üî¥ –ü–û–°–õ–ï–î–ù–ï–ï –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–ï!\n\n–í—Å–µ —É—á–µ–Ω–∏–∫–∏ –∏ —Ä–æ–¥–∏—Ç–µ–ª–∏ –ø–æ—Ç–µ—Ä—è—é—Ç –¥–æ—Å—Ç—É–ø –∫ —Å–≤–æ–∏–º –∞–∫–∫–∞—É–Ω—Ç–∞–º!\n–í–∞–º –ø—Ä–∏–¥–µ—Ç—Å—è —Å–æ–æ–±—â–∏—Ç—å –∏–º –Ω–æ–≤—ã–µ –ø–∞—Ä–æ–ª–∏.\n\n–¢–æ—á–Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å?')) {
            window.location.href = '/–ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å-–≤—Å–µ-–∞–∫–∫–∞—É–Ω—Ç—ã';
        }
    }
}

function confirmClearReports() {
    if (confirm('‚ö†Ô∏è –£–¥–∞–ª–∏—Ç—å –í–°–ï –æ—Ç—á–µ—Ç—ã –ø–æ —É—Ä–æ–∫–∞–º?\n\n–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!')) {
        if (confirm('üî¥ –¢–æ—á–Ω–æ —É–¥–∞–ª–∏—Ç—å? –í—Å–µ –æ—Ç—á–µ—Ç—ã –±—É–¥—É—Ç –ø–æ—Ç–µ—Ä—è–Ω—ã –Ω–∞–≤—Å–µ–≥–¥–∞!')) {
            window.location.href = '/admin/clear-all-reports';
        }
    }
}

function confirmClearHomework() {
    if (confirm('‚ö†Ô∏è –£–¥–∞–ª–∏—Ç—å –í–°–ï –¥–æ–º–∞—à–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è?\n\n–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!')) {
        if (confirm('üî¥ –¢–æ—á–Ω–æ —É–¥–∞–ª–∏—Ç—å? –í—Å–µ –¥–æ–º–∞—à–∫–∏ –±—É–¥—É—Ç –ø–æ—Ç–µ—Ä—è–Ω—ã –Ω–∞–≤—Å–µ–≥–¥–∞!')) {
            window.location.href = '/admin/clear-all-homework';
        }
    }
}

function confirmClearSchedule() {
    if (confirm('‚ö†Ô∏è –û–ß–ò–°–¢–ò–¢–¨ –í–°–Å –†–ê–°–ü–ò–°–ê–ù–ò–ï?\n\n–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ:\n- –£–¥–∞–ª–∏—Ç –í–°–ï —É—Ä–æ–∫–∏\n- –£–¥–∞–ª–∏—Ç –í–°–ï –ø–ª–∞—Ç–µ–∂–∏\n- –£–¥–∞–ª–∏—Ç –í–°–ï –æ—Ç—á–µ—Ç—ã\n- –£–¥–∞–ª–∏—Ç –í–°–ï –¥–æ–º–∞—à–∫–∏\n- –£–¥–∞–ª–∏—Ç —à–∞–±–ª–æ–Ω –Ω–µ–¥–µ–ª–∏\n\n–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –±—É–¥–µ—Ç –ù–ï–í–û–ó–ú–û–ñ–ù–û!\n\n–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?')) {
        if (confirm('üî¥ –ü–û–°–õ–ï–î–ù–ï–ï –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–ï!\n\n–í—ã —Ç–æ—á–Ω–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –í–°–Å?\n–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!')) {
            // –°–æ–∑–¥–∞–µ–º —Ñ–æ—Ä–º—É –¥–ª—è POST –∑–∞–ø—Ä–æ—Å–∞
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = '/–∞–¥–º–∏–Ω/–æ—á–∏—Å—Ç–∏—Ç—å-—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ';
            form.style.display = 'none';
            document.body.appendChild(form);
            form.submit();
        }
    }
}

</script>

<script>
// –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —É—Ä–æ–∫–∞
let selectedLesson = null;

let currentMode = 'report'; // –ù–û–í–ê–Ø –°–¢–†–û–ö–ê

// –ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø - –¥–æ–±–∞–≤—å –µ—ë –ø–æ—Å–ª–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö, –Ω–æ –ø–µ—Ä–µ–¥ function selectLesson
function switchMode(mode) {
    currentMode = mode;
    
    // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏
    document.getElementById('report_mode').classList.remove('active');
    document.getElementById('homework_mode').classList.remove('active');
    document.getElementById(mode + '_mode').classList.add('active');
    
    // –ü–µ—Ä–µ–∫—Ä–∞—à–∏–≤–∞–µ–º –≤—Å–µ —É—Ä–æ–∫–∏ —Å–æ–≥–ª–∞—Å–Ω–æ –Ω–æ–≤–æ–º—É —Ä–µ–∂–∏–º—É
    updateLessonsColors();
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—É—é —Ñ–æ—Ä–º—É
    updateFormsVisibility();

}

function updateLessonsColors() {
    // –ü—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Å —Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è —Ç–µ–∫—É—â–µ–π –¥–∞—Ç—ã
    const selectedDate = document.getElementById('date_select').value;
    
    if (selectedDate) {
        console.log('–ü–µ—Ä–µ–∫—Ä–∞—à–∏–≤–∞–µ–º —É—Ä–æ–∫–∏');
        loadLessonsForDate(selectedDate);
        
        // –ò –∑–∞–≥—Ä—É–∂–∞–µ–º –≤—á–µ—Ä–∞—à–Ω–∏–µ –µ—Å–ª–∏ —ç—Ç–æ —Å–µ–≥–æ–¥–Ω—è
        if (selectedDate === new Date().toISOString().split('T')[0]) {
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            const yesterdayStr = yesterday.toISOString().split('T')[0];
            loadYesterdayLessons(yesterdayStr);
        }
    }
}

function updateLessonColorForReport(lesson) {
    // –ö—Ä–∞—Å–Ω—ã–π = —É—Ä–æ–∫ –ø—Ä–æ–≤–µ–¥–µ–Ω, –æ—Ç—á–µ—Ç –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω
    lesson.style.background = 'linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(127, 29, 29, 0.2))';
    lesson.style.borderLeftColor = '#ef4444';
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç —Å—Ç–∞—Ç—É—Å–∞
    const statusDiv = lesson.querySelector('div:last-child');
    statusDiv.innerHTML = '<span style="color: #ef4444; font-weight: bold;">–ù–µ—Ç –æ—Ç—á–µ—Ç–∞</span>';
}

function updateLessonColorForHomework(lesson) {
    // –ñ–µ–ª—Ç—ã–π = —É—Ä–æ–∫ –ø—Ä–æ–≤–µ–¥–µ–Ω, –¥–æ–º–∞—à–∫–∞ –∑–∞–¥–∞–Ω–∞, –Ω–æ –Ω–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞  
    lesson.style.background = 'linear-gradient(135deg, rgba(245, 158, 11, 0.2), rgba(217, 119, 6, 0.2))';
    lesson.style.borderLeftColor = '#f59e0b';
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç —Å—Ç–∞—Ç—É—Å–∞
    const statusDiv = lesson.querySelector('div:last-child');
    statusDiv.innerHTML = '<span style="color: #f59e0b; font-weight: bold;">–ù–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞</span>';
}

function updateFormsVisibility() {
    const lessonForms = document.getElementById('lesson_forms');
    
    if (!lessonForms || lessonForms.style.display === 'none') {
        return; // –ï—Å–ª–∏ —Ñ–æ—Ä–º—ã —Å–∫—Ä—ã—Ç—ã, –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
    }
    
    // –ù–∞—Ö–æ–¥–∏–º –±–ª–æ–∫–∏ —Ñ–æ—Ä–º
    const reportForm = lessonForms.querySelector('.report-form');
    const homeworkForm = lessonForms.querySelector('.homework-form');
    
    if (currentMode === 'report') {
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ —Ñ–æ—Ä–º—É –æ—Ç—á–µ—Ç–∞
        if (reportForm) reportForm.style.display = 'block';
        if (homeworkForm) homeworkForm.style.display = 'none';
    } else {
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ —Ñ–æ—Ä–º—É –¥–æ–º–∞—à–∫–∏
        if (reportForm) reportForm.style.display = 'none';
        if (homeworkForm) homeworkForm.style.display = 'block';
    }
}

function updateStaticDates() {
    // –ü–æ–ª—É—á–∞–µ–º —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞—Ç—ã
    const today = new Date();
    const yesterday = new Date(today);
    yesterday.setDate(today.getDate() - 1);
    
    // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è (–î–î.–ú–ú.–ì–ì–ì–ì)
    const todayFormatted = today.toLocaleDateString('ru-RU');
    const yesterdayFormatted = yesterday.toLocaleDateString('ru-RU');
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏
    document.getElementById('yesterday_date').textContent = `(${yesterdayFormatted})`;
    document.getElementById('today_lessons_date').textContent = `(${todayFormatted})`;
    
    console.log('–î–∞—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã:', yesterdayFormatted, '–∏', todayFormatted);
}

function updateDateDisplay(selectedDate) {
    const titleElement = document.getElementById('today_lessons_title');
    const dateElement = document.getElementById('today_lessons_date');
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞—Ç—É "–≤—á–µ—Ä–∞" 
    const yesterdayElement = document.getElementById('yesterday_date');
    
    // –í—ã—á–∏—Å–ª—è–µ–º –≤—á–µ—Ä–∞—à–Ω—é—é –¥–∞—Ç—É –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–π
    const selectedDateObj = new Date(selectedDate);
    selectedDateObj.setDate(selectedDateObj.getDate() - 1);
    const yesterdayFormatted = selectedDateObj.toLocaleDateString('ru-RU');
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—á–µ—Ä–∞—à–Ω–µ–π –¥–∞—Ç—ã
    yesterdayElement.textContent = `(${yesterdayFormatted})`;
    
    // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞—Ç—É –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è (–æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –∫–∞–∫ –±—ã–ª)
    let displayDate, displayTitle;
    
    if (selectedDate === '2025-08-15') {
        // –≠—Ç–æ —Å–µ–≥–æ–¥–Ω—è
        displayTitle = '–£—Ä–æ–∫–∏ —Å–µ–≥–æ–¥–Ω—è';
        displayDate = '(15.08.2025)';
    } else {
        // –î—Ä—É–≥–∞—è –¥–∞—Ç–∞
        const dateObj = new Date(selectedDate);
        const day = dateObj.getDate().toString().padStart(2, '0');
        const month = (dateObj.getMonth() + 1).toString().padStart(2, '0');
        const year = dateObj.getFullYear();
        
        displayTitle = '–£—Ä–æ–∫–∏ –≤';
        displayDate = `(${day}.${month}.${year})`;
    }
    
    titleElement.textContent = displayTitle;
    dateElement.textContent = displayDate;
}

function loadRealCounters(selectedMonth = null) {
    console.log('üî¢ –ó–∞–≥—Ä—É–∂–∞–µ–º —Ä–µ–∞–ª—å–Ω—ã–µ —Å—á–µ—Ç—á–∏–∫–∏ –¥–ª—è –º–µ—Å—è—Ü–∞:', selectedMonth);
    
    // –ï—Å–ª–∏ –º–µ—Å—è—Ü –Ω–µ —É–∫–∞–∑–∞–Ω, –±–µ—Ä–µ–º —Ç–µ–∫—É—â–∏–π
    if (!selectedMonth) {
        const today = new Date();
        selectedMonth = today.getFullYear() + '-' + (today.getMonth() + 1).toString().padStart(2, '0');
    }
    
    fetch(`/api/get-counters?month=${selectedMonth}`)
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            console.log('‚úÖ –°—á–µ—Ç—á–∏–∫–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã:', data.counters);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            document.getElementById('homework_missing_count').textContent = data.counters.homework_missing;
            document.getElementById('homework_unchecked_count').textContent = data.counters.homework_unchecked;
            document.getElementById('reports_missing_count').textContent = data.counters.reports_missing;
        } else {
            console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—á–µ—Ç—á–∏–∫–æ–≤:', data.error);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É –≤–º–µ—Å—Ç–æ —Ü–∏—Ñ—Ä
            document.getElementById('homework_missing_count').textContent = '?';
            document.getElementById('homework_unchecked_count').textContent = '?';
            document.getElementById('reports_missing_count').textContent = '?';
        }
    })
    .catch(error => {
        console.error('‚ùå –°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—á–µ—Ç—á–∏–∫–æ–≤:', error);
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É
        document.getElementById('homework_missing_count').textContent = '!';
        document.getElementById('homework_unchecked_count').textContent = '!';
        document.getElementById('reports_missing_count').textContent = '!';
    });
}

function loadLessonsForDate(date) {
    console.log('–ó–∞–≥—Ä—É–∂–∞–µ–º —É—Ä–æ–∫–∏ –¥–ª—è –¥–∞—Ç—ã:', date);
    
    fetch(`/api/get-lessons/${date}`)
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            updateLessonsDisplay(data.lessons, date);
        } else {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —É—Ä–æ–∫–æ–≤:', data.error);
        }
    })
    .catch(error => {
        console.error('–û—à–∏–±–∫–∞:', error);
    });
}

function loadYesterdayLessons(date) {
    fetch(`/api/get-lessons/${date}`)
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            updateYesterdayLessonsDisplay(data.lessons);
        }
    })
    .catch(error => console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤—á–µ—Ä–∞—à–Ω–∏—Ö —É—Ä–æ–∫–æ–≤:', error));
}

function updateYesterdayLessonsDisplay(lessons) {
    // –î–û–ë–ê–í–¨ –≠–¢–£ –°–¢–†–û–ö–£ –í –°–ê–ú–û–ï –ù–ê–ß–ê–õ–û:
    window.yesterdayLessonsData = lessons; // —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤—á–µ—Ä–∞—à–Ω–∏–µ –¥–∞–Ω–Ω—ã–µ
    
    console.log('–í—á–µ—Ä–∞—à–Ω–∏–µ —É—Ä–æ–∫–∏:', lessons);
    
    // –ù–∞—Ö–æ–¥–∏–º —Ç–∞–±–ª–∏—Ü—É –≤—á–µ—Ä–∞—à–Ω–∏—Ö —É—Ä–æ–∫–æ–≤
    const yesterdayTable = document.querySelector('div[style*="grid-template-columns"] table');
    const yesterdayRows = yesterdayTable.querySelectorAll('tr');
    const yesterdayFirstRowCells = yesterdayRows[0].querySelectorAll('td:not(:first-child)'); // –ø–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞, –∫—Ä–æ–º–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞
    const yesterdaySecondRowCells = yesterdayRows[1].querySelectorAll('td'); // –≤—Ç–æ—Ä–∞—è —Å—Ç—Ä–æ–∫–∞, –≤—Å–µ —è—á–µ–π–∫–∏
    const allYesterdayCells = [...yesterdayFirstRowCells, ...yesterdaySecondRowCells];
    
    // –°–∫—Ä—ã–≤–∞–µ–º –≤—Ç–æ—Ä—É—é —Å—Ç—Ä–æ–∫—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    const yesterdayRow2 = document.getElementById('yesterday_row_2');
    yesterdayRow2.style.display = 'none';
    
    // –û—á–∏—â–∞–µ–º –≤—Å–µ —è—á–µ–π–∫–∏ –≤—á–µ—Ä–∞
    allYesterdayCells.forEach(cell => {
        cell.innerHTML = '<div style="text-align: center; color: var(--text-muted); font-style: italic;">–ù–µ—Ç —É—Ä–æ–∫–∞</div>';
        cell.style.background = 'var(--bg-card)';
        cell.style.borderLeftColor = 'var(--border-secondary)';
        cell.onclick = null;
    });
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Ç–æ—Ä—É—é —Å—Ç—Ä–æ–∫—É –µ—Å–ª–∏ —É—Ä–æ–∫–æ–≤ –±–æ–ª—å—à–µ 6
    if (lessons.length > 6) {
        yesterdayRow2.style.display = 'table-row';
    }
    
    // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ä–µ–∞–ª—å–Ω—ã–º–∏ —É—Ä–æ–∫–∞–º–∏ (–º–∞–∫—Å–∏–º—É–º 12)
    lessons.slice(0, 12).forEach((lesson, index) => {
        const cell = allYesterdayCells[index];
        if (cell) {
            const statusInfo = getLessonStatusInfo(lesson);
            
            cell.innerHTML = `
                <div style="background: var(--accent-gradient); color: white; padding: 8px 12px; border-radius: 6px; 
                           font-size: 16px; font-weight: bold; margin-bottom: 10px; text-align: center; min-width: 70px;">
                    ${lesson.time}
                </div>
                <div style="font-weight: bold; margin-bottom: 6px; font-size: 16px;">${lesson.student}</div>
                <div style="font-size: 14px; margin-bottom: 6px;">${lesson.subject}</div>
                <div style="font-size: 12px; color: ${statusInfo.color}; font-weight: bold;">${statusInfo.text}</div>
            `;
            
            cell.style.background = statusInfo.background;
            cell.style.borderLeftColor = statusInfo.borderColor;
            cell.onclick = () => selectLesson(lesson.id);
            cell.style.cursor = 'pointer';
        }
    });
}

function updateLessonsDisplay(lessons, date) {
    // –î–û–ë–ê–í–¨ –≠–¢–£ –°–¢–†–û–ö–£ –í –°–ê–ú–û–ï –ù–ê–ß–ê–õ–û:
    window.currentLessonsData = lessons; // —Å–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è —Ñ–æ—Ä–º
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
    updateDateDisplay(date);
    
    // –ù–∞—Ö–æ–¥–∏–º –≤—Ç–æ—Ä—É—é —Ç–∞–±–ª–∏—Ü—É (—É—Ä–æ–∫–∏ —Å–µ–≥–æ–¥–Ω—è)
    const todayTable = document.querySelectorAll('div[style*="grid-template-columns"] table')[1];
    const todayRows = todayTable.querySelectorAll('tr');
    const todayFirstRowCells = todayRows[0].querySelectorAll('td:not(:first-child)'); // –ø–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞, –∫—Ä–æ–º–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞
    const todaySecondRowCells = todayRows[1].querySelectorAll('td'); // –≤—Ç–æ—Ä–∞—è —Å—Ç—Ä–æ–∫–∞, –≤—Å–µ —è—á–µ–π–∫–∏
    const allTodayCells = [...todayFirstRowCells, ...todaySecondRowCells];
    
    // –°–∫—Ä—ã–≤–∞–µ–º –≤—Ç–æ—Ä—É—é —Å—Ç—Ä–æ–∫—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    const todayRow2 = document.getElementById('today_row_2');
    todayRow2.style.display = 'none';
    
    // –û—á–∏—â–∞–µ–º –≤—Å–µ —è—á–µ–π–∫–∏
    allTodayCells.forEach(cell => {
        cell.innerHTML = '<div style="text-align: center; color: var(--text-muted); font-style: italic;">–ù–µ—Ç —É—Ä–æ–∫–∞</div>';
        cell.style.background = 'var(--bg-card)';
        cell.style.borderLeftColor = 'var(--border-secondary)';
        cell.onclick = null;
    });
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Ç–æ—Ä—É—é —Å—Ç—Ä–æ–∫—É –µ—Å–ª–∏ —É—Ä–æ–∫–æ–≤ –±–æ–ª—å—à–µ 6
    if (lessons.length > 6) {
        todayRow2.style.display = 'table-row';
    }
    
    // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ä–µ–∞–ª—å–Ω—ã–º–∏ —É—Ä–æ–∫–∞–º–∏ (–º–∞–∫—Å–∏–º—É–º 12)
    lessons.slice(0, 12).forEach((lesson, index) => {
        const cell = allTodayCells[index];
        if (cell) {
            const statusInfo = getLessonStatusInfo(lesson);
            
            cell.innerHTML = `
                <div style="background: var(--accent-gradient); color: white; padding: 8px 12px; border-radius: 6px; 
                           font-size: 16px; font-weight: bold; margin-bottom: 10px; text-align: center; min-width: 70px;">
                    ${lesson.time}
                </div>
                <div style="font-weight: bold; margin-bottom: 6px; font-size: 16px;">${lesson.student}</div>
                <div style="font-size: 14px; margin-bottom: 6px;">${lesson.subject}</div>
                <div style="font-size: 12px; color: ${statusInfo.color}; font-weight: bold;">${statusInfo.text}</div>
            `;
            
            cell.style.background = statusInfo.background;
            cell.style.borderLeftColor = statusInfo.borderColor;
            cell.onclick = () => selectLesson(lesson.id);
            cell.style.cursor = 'pointer';
        }
    });
}

function getLessonStatusInfo(lesson) {
    if (lesson.status === 'scheduled') {
        // –°–∏–Ω–∏–π –¥–ª—è –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö
        return {
            color: '#0ea5e9',
            text: '‚è∞ –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω',
            background: 'linear-gradient(135deg, rgba(14, 165, 233, 0.15), rgba(2, 132, 199, 0.15))',
            borderColor: '#0ea5e9'
        };
    }
    
    if (lesson.status === 'completed') {
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –æ—Ç—á–µ—Ç–∞
        let reportEmoji = lesson.has_report ? '‚úÖ' : '‚ùå';
        
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –¥–æ–º–∞—à–∫–∏
        let homeworkEmoji = '‚ùå'; // –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–µ—Ç –¥–æ–º–∞—à–∫–∏
        
        if (lesson.has_homework) {
            if (lesson.homework_type === 'none') {
                // –û—Å–æ–∑–Ω–∞–Ω–Ω–æ –Ω–µ –∑–∞–¥–∞–Ω–æ - –≥–∞–ª–æ—á–∫–∞
                homeworkEmoji = '‚úÖ';
            } else if (lesson.homework_checked) {
                // –ó–∞–¥–∞–Ω–æ –∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ - –≥–∞–ª–æ—á–∫–∞
                homeworkEmoji = '‚úÖ';
            } else {
                // –ó–∞–¥–∞–Ω–æ, –Ω–æ –Ω–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ - –ø–µ—Å–æ—á–Ω—ã–µ —á–∞—Å—ã
                homeworkEmoji = '‚è≥';
            }
        }
        
        // –ì–æ–ª—É–±–æ–π —Ü–≤–µ—Ç –¥–ª—è –≤—Å–µ—Ö –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö —É—Ä–æ–∫–æ–≤
        return {
            color: '#D9F6F4', // —Å–≤–µ—Ç–ª—ã–π —Ü–≤–µ—Ç –∏–∑ —Ç–≤–æ–∏—Ö CSS –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
            text: `${reportEmoji} –û—Ç—á–µ—Ç  ${homeworkEmoji} –î–æ–º–∞—à–∫–∞`,
            background: 'linear-gradient(135deg, rgba(0, 212, 255, 0.2), rgba(30, 58, 138, 0.2))',
            borderColor: '#00d4ff'
        };
    }
    
    // –°–µ—Ä—ã–π –¥–ª—è –æ—Ç–º–µ–Ω–µ–Ω–Ω—ã—Ö
    return {
        color: '#6b7280',
        text: '‚è∏Ô∏è –û—Ç–º–µ–Ω–µ–Ω',
        background: 'linear-gradient(135deg, rgba(107, 114, 128, 0.15), rgba(75, 85, 99, 0.15))',
        borderColor: '#6b7280'
    };
}

function fillFormWithExistingData(lesson) {
    console.log('–ó–∞–ø–æ–ª–Ω—è–µ–º —Ñ–æ—Ä–º—É –¥–∞–Ω–Ω—ã–º–∏ —É—Ä–æ–∫–∞:', lesson);
    
    // === –û–ß–ò–©–ê–ï–ú –í–°–ï –ü–û–õ–Ø –°–ù–ê–ß–ê–õ–ê ===
    clearAllFormFields();
    
    // === –ó–ê–ü–û–õ–ù–Ø–ï–ú –û–¢–ß–ï–¢ ===
    if (lesson.report_data) {
        console.log('–ù–∞–π–¥–µ–Ω –æ—Ç—á–µ—Ç, –∑–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª—è:', lesson.report_data);
        
        document.getElementById('report_topic').value = lesson.report_data.topic || '';
        document.getElementById('report_understanding').value = lesson.report_data.understanding_level || '';
        document.getElementById('report_comment').value = lesson.report_data.teacher_comment || '';
        
        // –ü–æ–∫–∞ –±–∞–ª–ª—ã –Ω–µ –¥–æ–±–∞–≤–ª—è–µ–º - –¥–æ–±–∞–≤–∏–º –ø–æ—Ç–æ–º –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
        // document.getElementById('report_primary_score').value = lesson.report_data.primary_score || '';
        // document.getElementById('report_secondary_score').value = lesson.report_data.secondary_score || '';
    }
    
    // === –ó–ê–ü–û–õ–ù–Ø–ï–ú –î–û–ú–ê–®–ö–£ ===
    if (lesson.homework_data) {
        console.log('–ù–∞–π–¥–µ–Ω–∞ –¥–æ–º–∞—à–∫–∞, –∑–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª—è:', lesson.homework_data);
        
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –¥–æ–º–∞—à–∫–∏
        let homeworkType = 'tasks'; // –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        if (lesson.homework_data.description === '–ù–µ –∑–∞–¥–∞–≤–∞—Ç—å –¥–æ–º–∞—à–∫—É' || 
            lesson.homework_data.description.toLowerCase().includes('–Ω–µ –∑–∞–¥–∞–≤–∞—Ç—å')) {
            homeworkType = 'none';
        }
        
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∏–ø
        document.getElementById('homework_type').value = homeworkType;
        
        // –ó–∞–ø–æ–ª–Ω—è–µ–º –æ–ø–∏—Å–∞–Ω–∏–µ
        if (homeworkType === 'tasks') {
            document.getElementById('homework_description').value = lesson.homework_data.description || '';
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º –±–∞–ª–ª—ã –µ—Å–ª–∏ –µ—Å—Ç—å
            document.getElementById('homework_solution_score').value = lesson.homework_data.solution_score || '';
            document.getElementById('homework_formatting_score').value = lesson.homework_data.design_score || '';
            
            // –ü–æ–∫–∞ —ç—Ç–∏ –±–∞–ª–ª—ã –Ω–µ –¥–æ–±–∞–≤–ª—è–µ–º
            // document.getElementById('homework_primary_score').value = lesson.homework_data.primary_score || '';
            // document.getElementById('homework_secondary_score').value = lesson.homework_data.secondary_score || '';
        }
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—ã–µ –ø–æ–ª—è
        toggleHomeworkFields();
    }
}

function clearAllFormFields() {
    // –û—á–∏—â–∞–µ–º –ø–æ–ª—è –æ—Ç—á–µ—Ç–∞
    document.getElementById('report_topic').value = '';
    document.getElementById('report_understanding').value = '';
    document.getElementById('report_comment').value = '';
    document.getElementById('report_primary_score').value = '';
    document.getElementById('report_secondary_score').value = '';
    
    // –û—á–∏—â–∞–µ–º –ø–æ–ª—è –¥–æ–º–∞—à–∫–∏
    document.getElementById('homework_type').value = '';
    document.getElementById('homework_description').value = '';
    document.getElementById('homework_solution_score').value = '';
    document.getElementById('homework_formatting_score').value = '';
    document.getElementById('homework_primary_score').value = '';
    document.getElementById('homework_secondary_score').value = '';
    
    // –°–∫—Ä—ã–≤–∞–µ–º –ø–æ–ª—è –¥–æ–º–∞—à–∫–∏
    toggleHomeworkFields();
}

function selectLesson(lessonId) {
    selectedLesson = lessonId;
    
    // –£–±–∏—Ä–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å–æ –≤—Å–µ—Ö —É—Ä–æ–∫–æ–≤
    document.querySelectorAll('td[style*="cursor: pointer"]').forEach(lesson => {
        lesson.classList.remove('lesson-selected');
    });
    
    // –í—ã–¥–µ–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —É—Ä–æ–∫
    event.currentTarget.classList.add('lesson-selected');
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–æ—Ä–º—ã
    document.getElementById('lesson_forms').style.display = 'block';
    
    // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ —É—Ä–æ–∫–∞ –∏–∑ DOM —ç–ª–µ–º–µ–Ω—Ç–∞
    const lessonElement = event.currentTarget;
    const timeElement = lessonElement.querySelector('div:first-child');
    const studentElement = lessonElement.querySelector('div:nth-child(2)');
    const subjectElement = lessonElement.querySelector('div:nth-child(3)');
    
    if (timeElement && studentElement && subjectElement) {
        const time = timeElement.textContent.trim();
        const student = studentElement.textContent.trim();
        const subject = subjectElement.textContent.trim();
        
        // –ü–æ–ª—É—á–∞–µ–º –¥–∞—Ç—É –∏–∑ input
        const selectedDate = document.getElementById('date_select').value;
        const dateObj = new Date(selectedDate);
        const dateStr = dateObj.toLocaleDateString('ru-RU');
        
        document.getElementById('selected_lesson_info').innerHTML = 
            `–†–∞–±–æ—Ç–∞–µ–º —Å —É—Ä–æ–∫–æ–º: ${student} - ${subject} (${time}, ${dateStr})`;
    } else {
        document.getElementById('selected_lesson_info').innerHTML = 
            `–†–∞–±–æ—Ç–∞–µ–º —Å —É—Ä–æ–∫–æ–º ID: ${lessonId}`;
    }

    // === –ù–û–í–ê–Ø –ß–ê–°–¢–¨: –ò—â–µ–º –¥–∞–Ω–Ω—ã–µ —É—Ä–æ–∫–∞ –∏ –∑–∞–ø–æ–ª–Ω—è–µ–º —Ñ–æ—Ä–º—É ===
    console.log('–ò—â–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —É—Ä–æ–∫–∞ ID:', lessonId);

    // –ò—â–µ–º —É—Ä–æ–∫ –≤ —Å–µ–≥–æ–¥–Ω—è—à–Ω–∏—Ö –¥–∞–Ω–Ω—ã—Ö
    let lesson = null;
    if (window.currentLessonsData) {
        lesson = window.currentLessonsData.find(l => l.id === lessonId);
    }

    // –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ —Å–µ–≥–æ–¥–Ω—è—à–Ω–∏—Ö, –∏—â–µ–º –≤–æ –≤—á–µ—Ä–∞—à–Ω–∏—Ö
    if (!lesson && window.yesterdayLessonsData) {
        lesson = window.yesterdayLessonsData.find(l => l.id === lessonId);
        console.log('–ò—â–µ–º –≤–æ –≤—á–µ—Ä–∞—à–Ω–∏—Ö –¥–∞–Ω–Ω—ã—Ö...');
    }

    if (lesson) {
        console.log('–ù–∞–π–¥–µ–Ω —É—Ä–æ–∫ —Å –¥–∞–Ω–Ω—ã–º–∏:', lesson);
        fillFormWithExistingData(lesson);
    } else {
        console.log('–£—Ä–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω –Ω–∏ –≤ —Ç–µ–∫—É—â–∏—Ö, –Ω–∏ –≤–æ –≤—á–µ—Ä–∞—à–Ω–∏—Ö –¥–∞–Ω–Ω—ã—Ö');
        clearAllFormFields();
    }
}

// –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –ø–æ–ª–µ–π –¥–æ–º–∞—à–∫–∏
function toggleHomeworkFields() {
    const homeworkType = document.getElementById('homework_type').value;
    const contentFields = document.getElementById('homework_content_fields');
    const probnikFields = document.getElementById('homework_probnik_fields');
    const evaluationFields = document.getElementById('homework_evaluation_fields');
    const formattingFields = document.getElementById('homework_formatting_fields');
    
    if (homeworkType === 'tasks') {
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ –ø–æ–ª—è –¥–ª—è "–¥–∞—Ç—å –∑–∞–¥–∞—á–∏"
        contentFields.style.display = 'block';
        probnikFields.style.display = 'grid';
        evaluationFields.style.display = 'block';
        formattingFields.style.display = 'block';
    } else {
        // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –ø–æ–ª—è
        contentFields.style.display = 'none';
        probnikFields.style.display = 'none';
        evaluationFields.style.display = 'none';
        formattingFields.style.display = 'none';
    }
}

document.addEventListener('DOMContentLoaded', function() {
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–∞–ª–µ–Ω–¥–∞—Ä—å –¥–∞—Ç
    const dateSelect = document.getElementById('date_select');
    const monthSelect = document.getElementById('month_select');
    const today = new Date();
    
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–µ–≥–æ–¥–Ω—è—à–Ω—é—é –¥–∞—Ç—É
    const todayStr = today.toISOString().split('T')[0];
    dateSelect.value = todayStr;
    
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü  
    const currentMonth = today.getFullYear() + '-' + (today.getMonth() + 1).toString().padStart(2, '0');
    monthSelect.value = currentMonth;
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–∞—Ç—ã
    dateSelect.addEventListener('change', function() {
        const selectedDate = this.value;
        console.log('–í—ã–±—Ä–∞–Ω–∞ –¥–∞—Ç–∞:', selectedDate);
        
        if (selectedDate) {
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —É—Ä–æ–∫–∏ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π –¥–∞—Ç—ã
            loadLessonsForDate(selectedDate);
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —É—Ä–æ–∫–∏ –≤—á–µ—Ä–∞ (–Ω–∞ –¥–µ–Ω—å —Ä–∞–Ω—å—à–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –¥–∞—Ç—ã)
            const selectedDateObj = new Date(selectedDate);
            selectedDateObj.setDate(selectedDateObj.getDate() - 1);
            const yesterdayStr = selectedDateObj.toISOString().split('T')[0];
            loadYesterdayLessons(yesterdayStr);
        }
    });
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è –º–µ—Å—è—Ü–∞
    monthSelect.addEventListener('change', function() {
        const selectedMonth = this.value;
        console.log('–í—ã–±—Ä–∞–Ω –º–µ—Å—è—Ü –¥–ª—è —Å—á–µ—Ç—á–∏–∫–æ–≤:', selectedMonth);
        
        if (selectedMonth) {
            // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—á–µ—Ç—á–∏–∫–∏ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –º–µ—Å—è—Ü–∞
            loadRealCounters(selectedMonth);
        }
    });
    
    // –û—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏...
    updateLessonsColors();
    updateFormsVisibility();
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—á–µ—Ç—á–∏–∫–∏ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞
    loadRealCounters(currentMonth);
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —É—Ä–æ–∫–∏ –¥–ª—è —Å–µ–≥–æ–¥–Ω—è –∏ –≤—á–µ—Ä–∞
    const yesterday = new Date(today);
    yesterday.setDate(today.getDate() - 1);
    const yesterdayStr = yesterday.toISOString().split('T')[0];

    updateStaticDates();
    loadLessonsForDate(todayStr);
    loadYesterdayLessons(yesterdayStr);
});

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–æ–±–Ω–∏–∫–∞
function openProbnikModal(type) {
    const modalTitle = type === 'report' ? '–ü—Ä–æ–±–Ω–∏–∫ –¥–ª—è –æ—Ç—á–µ—Ç–∞' : '–ü—Ä–æ–±–Ω–∏–∫ –¥–ª—è –¥–æ–º–∞—à–∫–∏';
    
    // –°–æ–∑–¥–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
    const modal = document.createElement('div');
    modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 9999;
    `;
    
    modal.innerHTML = `
        <div style="background: var(--bg-secondary); border-radius: 20px; padding: 30px; max-width: 600px; width: 90%; border: 1px solid var(--border-primary);">
            <h3 style="color: var(--text-accent); margin-bottom: 20px; text-align: center;">${modalTitle}</h3>
            
            <div style="background: var(--bg-card); padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                <h4 style="color: var(--text-primary); margin-bottom: 15px;">üöÄ –ë—É–¥—É—â–∞—è —Ñ—É–Ω–∫—Ü–∏—è:</h4>
                <ul style="color: var(--text-muted); line-height: 1.6;">
                    <li>‚úÖ –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∑–∞–¥–∞–Ω–∏–π –ø—Ä–æ–±–Ω–∏–∫–∞ —Å –≥–∞–ª–æ—á–∫–∞–º–∏</li>
                    <li>‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–¥—Å—á–µ—Ç –ø–µ—Ä–≤–∏—á–Ω—ã—Ö –±–∞–ª–ª–æ–≤</li>
                    <li>‚úÖ –ü–µ—Ä–µ–≤–æ–¥ –≤ –±–∞–ª–ª—ã –ï–ì–≠/–û–ì–≠ (–≤—Ç–æ—Ä–∏—á–Ω—ã–µ)</li>
                    <li>‚úÖ –†–∞–∑–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–ª—è –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏, —Ñ–∏–∑–∏–∫–∏, —Ö–∏–º–∏–∏</li>
                    <li>‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¥–∏–∞–≥—Ä–∞–º–º–∞–º–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞</li>
                </ul>
                
                <p style="margin-top: 15px; font-style: italic; color: var(--text-accent);">
                    –ü—Ä–∏–º–µ—Ä: –ó–∞–¥–∞–Ω–∏–µ 1 ‚úÖ (1 –±–∞–ª–ª), –ó–∞–¥–∞–Ω–∏–µ 2 ‚ùå (1 –±–∞–ª–ª)... ‚Üí –ò—Ç–æ–≥–æ: 15/31 ‚Üí 68 –±–∞–ª–ª–æ–≤ –ï–ì–≠
                </p>
            </div>
            
            <div style="text-align: center;">
                <button onclick="this.closest('[style*=\"position: fixed\"]').remove()" 
                        style="background: var(--accent-gradient); color: white; padding: 12px 24px; border: none; border-radius: 12px; cursor: pointer;">
                    –ü–æ–Ω—è—Ç–Ω–æ, –ø–æ—Ç–æ–º –¥–æ–¥–µ–ª–∞–µ–º!
                </button>
            </div>
        </div>
    `;
    
    // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –Ω–∞ —Ñ–æ–Ω
    modal.addEventListener('click', function(e) {
        if (e.target === modal) {
            modal.remove();
        }
    });
    
    document.body.appendChild(modal);
}

function saveReport() {
    if (!selectedLesson) {
        alert('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —É—Ä–æ–∫!');
        return;
    }
    
    // –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã
    const reportData = {
        lesson_id: selectedLesson,
        topic: document.getElementById('report_topic').value,
        understanding_level: document.getElementById('report_understanding').value,
        teacher_comment: document.getElementById('report_comment').value,
        primary_score: document.getElementById('report_primary_score').value,
        secondary_score: document.getElementById('report_secondary_score').value
    };
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
    if (!reportData.topic.trim()) {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ —Ç–µ–º—É —É—Ä–æ–∫–∞');
        return;
    }
    
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º AJAX –∑–∞–ø—Ä–æ—Å
    fetch('/api/save-report', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(reportData)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('‚úÖ –û—Ç—á–µ—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω!');
            
            // === –ù–û–í–ê–Ø –ß–ê–°–¢–¨: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ ===
            refreshLessonData();
            
        } else {
            alert('‚ùå –û—à–∏–±–∫–∞: ' + data.error);
        }
    })
    .catch(error => {
        console.error('–û—à–∏–±–∫–∞:', error);
        alert('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –æ—Ç—á–µ—Ç–∞');
    });
}

function saveHomework() {
    if (!selectedLesson) {
        alert('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —É—Ä–æ–∫!');
        return;
    }
    
    // –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã –¥–æ–º–∞—à–∫–∏
    const homeworkData = {
        lesson_id: selectedLesson,
        homework_type: document.getElementById('homework_type').value,
        description: document.getElementById('homework_description').value,
        primary_score: document.getElementById('homework_primary_score').value,
        secondary_score: document.getElementById('homework_secondary_score').value,
        solution_score: document.getElementById('homework_solution_score').value,
        formatting_score: document.getElementById('homework_formatting_score').value
    };
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
    if (!homeworkData.homework_type) {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –¥–æ–º–∞—à–Ω–µ–≥–æ –∑–∞–¥–∞–Ω–∏—è');
        return;
    }
    
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º AJAX –∑–∞–ø—Ä–æ—Å
    fetch('/api/save-homework', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(homeworkData)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('‚úÖ –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ!');
            
            // === –ù–û–í–ê–Ø –ß–ê–°–¢–¨: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ ===
            refreshLessonData();
            
        } else {
            alert('‚ùå –û—à–∏–±–∫–∞: ' + data.error);
        }
    })
    .catch(error => {
        console.error('–û—à–∏–±–∫–∞:', error);
        alert('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–æ–º–∞—à–Ω–µ–≥–æ –∑–∞–¥–∞–Ω–∏—è');
    });
}

function deleteReport() {
    if (!selectedLesson) {
        alert('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —É—Ä–æ–∫!');
        return;
    }
    
    // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è
    if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –æ—Ç—á–µ—Ç –ø–æ —ç—Ç–æ–º—É —É—Ä–æ–∫—É?')) {
        return;
    }
    
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º AJAX –∑–∞–ø—Ä–æ—Å –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ
    fetch('/api/delete-report', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({lesson_id: selectedLesson})
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('‚úÖ –û—Ç—á–µ—Ç —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω!');
            
            // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
            document.querySelector('.report-form input[placeholder*="–ö–≤–∞–¥—Ä–∞—Ç–Ω—ã–µ"]').value = '';
            document.querySelector('.report-form select').value = '';
            document.querySelector('.report-form textarea').value = '';
            document.querySelector('.report-form input[placeholder="0-50"]').value = '';
            document.querySelector('.report-form input[placeholder="0-100"]').value = '';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É—Ä–æ–∫–∞ (—É–±–∏—Ä–∞–µ–º –≥–∞–ª–æ—á–∫—É)
            refreshLessonData();
        } else {
            alert('‚ùå –û—à–∏–±–∫–∞: ' + data.error);
        }
    })
    .catch(error => {
        console.error('–û—à–∏–±–∫–∞:', error);
        alert('‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –æ—Ç—á–µ—Ç–∞');
    });
}

function markHomeworkChecked() {
    if (!selectedLesson) {
        alert('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —É—Ä–æ–∫!');
        return;
    }
    
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º AJAX –∑–∞–ø—Ä–æ—Å
    fetch('/api/mark-homework-checked', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({lesson_id: selectedLesson})
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('‚úÖ –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ –æ—Ç–º–µ—á–µ–Ω–æ –∫–∞–∫ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω–æ–µ!');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É—Ä–æ–∫–∞
            refreshLessonData();
        } else {
            alert('‚ùå –û—à–∏–±–∫–∞: ' + data.error);
        }
    })
    .catch(error => {
        console.error('–û—à–∏–±–∫–∞:', error);
        alert('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–º–µ—Ç–∫–∏ –¥–æ–º–∞—à–∫–∏');
    });
}

function deleteHomework() {
    if (!selectedLesson) {
        alert('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —É—Ä–æ–∫!');
        return;
    }
    
    // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è
    if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –¥–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ –ø–æ —ç—Ç–æ–º—É —É—Ä–æ–∫—É?')) {
        return;
    }
    
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º AJAX –∑–∞–ø—Ä–æ—Å –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ
    fetch('/api/delete-homework', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({lesson_id: selectedLesson})
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('‚úÖ –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–æ!');
            
            // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
            document.getElementById('homework_type').value = '';
            document.querySelector('.homework-form textarea').value = '';
            document.querySelector('.homework-form input[placeholder="0-50"]').value = '';
            document.querySelector('.homework-form input[placeholder="0-100"]').value = '';
            document.querySelector('#homework_evaluation_fields select').value = '';
            document.querySelector('#homework_formatting_fields select').value = '';
            
            // –°–∫—Ä—ã–≤–∞–µ–º –ø–æ–ª—è
            toggleHomeworkFields();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É—Ä–æ–∫–∞
            refreshLessonData();
        } else {
            alert('‚ùå –û—à–∏–±–∫–∞: ' + data.error);
        }
    })
    .catch(error => {
        console.error('–û—à–∏–±–∫–∞:', error);
        alert('‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –¥–æ–º–∞—à–∫–∏');
    });
}

// –§—É–Ω–∫—Ü–∏—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –ª–æ–≥–∏–Ω–∞ –∏ –ø–∞—Ä–æ–ª—è
function copyLoginPassword(login, password) {
    const text = `–õ–æ–≥–∏–Ω: ${login}. –ü–∞—Ä–æ–ª—å: ${password}`;
    
    if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(text).then(function() {
            showCopyNotification('–õ–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã!');
        }).catch(function(err) {
            console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è: ', err);
            fallbackCopyToClipboard(text);
        });
    } else {
        fallbackCopyToClipboard(text);
    }
}

// –†–µ–∑–µ—Ä–≤–Ω—ã–π —Å–ø–æ—Å–æ–± –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
function fallbackCopyToClipboard(text) {
    const textArea = document.createElement("textarea");
    textArea.value = text;
    textArea.style.position = "fixed";
    textArea.style.left = "-999999px";
    textArea.style.top = "-999999px";
    document.body.appendChild(textArea);
    textArea.focus();
    textArea.select();
    
    try {
        const successful = document.execCommand('copy');
        if (successful) {
            showCopyNotification('–õ–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã!');
        }
    } catch (err) {
        console.error('Fallback –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å: ', err);
    }
    
    document.body.removeChild(textArea);
}

// –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–∏
function showCopyNotification(message = '‚úÖ –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!') {
    const notification = document.createElement('div');
    notification.textContent = message;
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: var(--success-color, #10b981);
        color: white;
        padding: 12px 20px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        z-index: 10000;
        font-weight: bold;
        animation: slideIn 0.3s ease-out;
    `;
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.style.animation = 'slideOut 0.3s ease-in';
        setTimeout(() => {
            if (document.body.contains(notification)) {
                document.body.removeChild(notification);
            }
        }, 300);
    }, 2000);
}

function refreshLessonData() {
    console.log('üîÑ –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ —É—Ä–æ–∫–æ–≤ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏');
    
    // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â—É—é –≤—ã–±—Ä–∞–Ω–Ω—É—é –¥–∞—Ç—É
    const selectedDate = document.getElementById('date_select').value;
    const selectedMonth = document.getElementById('month_select').value;
    
    if (selectedDate) {
        // 1. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —É—Ä–æ–∫–∏ –¥–ª—è —Ç–µ–∫—É—â–µ–π –¥–∞—Ç—ã
        loadLessonsForDate(selectedDate);
        
        // 2. –ï—Å–ª–∏ —ç—Ç–æ –≤—á–µ—Ä–∞—à–Ω—è—è –¥–∞—Ç–∞ —Ç–æ–∂–µ, –æ–±–Ω–æ–≤–ª—è–µ–º –≤—á–µ—Ä–∞—à–Ω–∏–µ
        const today = new Date().toISOString().split('T')[0];
        const yesterday = new Date();
        yesterday.setDate(yesterday.getDate() - 1);
        const yesterdayStr = yesterday.toISOString().split('T')[0];
        
        if (selectedDate === yesterdayStr) {
            // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –≤—á–µ—Ä–∞—à–Ω–∏–µ —É—Ä–æ–∫–∏
            loadYesterdayLessons(selectedDate);
        }
        
        // 3. –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫–∏ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞
        if (selectedMonth) {
            loadRealCounters(selectedMonth);
        }
        
        console.log('‚úÖ –î–∞–Ω–Ω—ã–µ —É—Ä–æ–∫–æ–≤ –æ–±–Ω–æ–≤–ª–µ–Ω—ã');
        
        // 4. –ß–µ—Ä–µ–∑ –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É –≤—ã–±–∏—Ä–∞–µ–º —É—Ä–æ–∫ –∑–∞–Ω–æ–≤–æ (—á—Ç–æ–±—ã —Ñ–æ—Ä–º–∞ –æ–±–Ω–æ–≤–∏–ª–∞—Å—å)
        setTimeout(() => {
            if (selectedLesson && window.currentLessonsData) {
                const lesson = window.currentLessonsData.find(l => l.id === selectedLesson);
                if (lesson) {
                    fillFormWithExistingData(lesson);
                    console.log('‚úÖ –§–æ—Ä–º–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞ —Å –Ω–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏');
                }
            }
        }, 500); // –∑–∞–¥–µ—Ä–∂–∫–∞ 500–º—Å —á—Ç–æ–±—ã –¥–∞–Ω–Ω—ã–µ —É—Å–ø–µ–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è
    }
}

</script>

{% endblock %}